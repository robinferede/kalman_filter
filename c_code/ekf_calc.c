
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// This file is automatically generated in "Generate Kalman Filter C Code.ipynb" from https://github.com/tudelft/kalman_filter   //
///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

#include "ekf_calc.h"
#include <math.h>

float ekf_use_phi = 1;
float ekf_use_theta = 1;
float ekf_use_psi = 1;

float ekf_Q[N_INPUTS];         // Kalman filter process noise covariance matrix (diagonal)
float ekf_R[N_MEASUREMENTS];   // Kalman filter measurement noise covariance matrix (diagonal)

// state
float ekf_X[N_STATES];
float ekf_X_new[N_STATES];

// covariance matrix (lower diagonal) P[i,j] = P_lower_diagonal[i*(i+1)/2+j] (if i>=j)
float ekf_P_lower_diagonal[N_STATES*(N_STATES+1)/2];
float ekf_P_lower_diagonal_new[N_STATES*(N_STATES+1)/2];

// temporary variables
float tmp[328];

// pointers
float *X = ekf_X;
float *X_new = ekf_X_new;

float *P = ekf_P_lower_diagonal;
float *P_new = ekf_P_lower_diagonal_new;

// renaming
float *Q = ekf_Q;
float *R = ekf_R;

// pointer for swapping
float *swap_ptr;

float* ekf_get_X() {
    return X;
}

float* ekf_get_P() {
    return P;
}

void ekf_set_Q(float Q[N_INPUTS]) {
    for (int i=0; i<N_INPUTS; i++) {
        ekf_Q[i] = Q[i];
    }
}

void ekf_set_R(float R[N_MEASUREMENTS]) {
    for (int i=0; i<N_MEASUREMENTS; i++) {
        ekf_R[i] = R[i];
    }
}

void ekf_set_X(float X0[N_STATES]) {
    for (int i=0; i<N_STATES; i++) {
        X[i] = X0[i];
    }
}

void ekf_set_P_diag(float P_diag[N_STATES]) {
    // set P to zeros
    for (int i=0; i<N_STATES*(N_STATES+1)/2; i++) {
        P[i] = 0.;
    }
    // set diagonal
    for (int i=0; i<N_STATES; i++) {
        P[i*(i+1)/2+i] = P_diag[i];
    }
}

void ekf_set_P(float P0[N_STATES*(N_STATES+1)/2]) {
    for (int i=0; i<N_STATES*(N_STATES+1)/2; i++) {
        P[i] = P0[i];
    }
}

void ekf_predict(float U[N_INPUTS], float dt) {
    // PREDICTION STEP X_new, P_new = ...
    tmp[0] = cosf(X[8]);
	tmp[1] = cosf(X[7]);
	tmp[2] = U[0] + U[1] + U[2] + U[3];
	tmp[3] = sinf(X[7]);
	tmp[4] = 6.0000000000000002e-5*X[3];
	tmp[5] = tmp[0]*tmp[4];
	tmp[6] = sinf(X[8]);
	tmp[7] = 6.0000000000000002e-5*X[4];
	tmp[8] = tmp[6]*tmp[7];
	tmp[9] = X[9] + tmp[2]*(6.0000000000000002e-5*X[5]*tmp[3] - tmp[1]*tmp[5] - tmp[1]*tmp[8]);
	tmp[10] = tmp[1]*tmp[9];
	tmp[11] = sinf(X[6]);
	tmp[12] = tmp[11]*tmp[6];
	tmp[13] = cosf(X[6]);
	tmp[14] = tmp[0]*tmp[13];
	tmp[15] = tmp[12] + tmp[14]*tmp[3];
	tmp[16] = -2.5000000000000002e-6*powf(U[0], 2) - 2.5000000000000002e-6*powf(U[1], 2) - 2.5000000000000002e-6*powf(U[2], 2) - 2.5000000000000002e-6*powf(U[3], 2) + X[11];
	tmp[17] = tmp[13]*tmp[6];
	tmp[18] = tmp[0]*tmp[11];
	tmp[19] = tmp[18]*tmp[3];
	tmp[20] = -tmp[17] + tmp[19];
	tmp[21] = 6.0000000000000002e-5*X[5]*tmp[1];
	tmp[22] = tmp[12]*tmp[3];
	tmp[23] = tmp[14] + tmp[22];
	tmp[24] = X[10] + tmp[2]*(-tmp[11]*tmp[21] - tmp[20]*tmp[4] - tmp[23]*tmp[7]);
	tmp[25] = tmp[0]*tmp[10] + tmp[15]*tmp[16] + tmp[20]*tmp[24];
	tmp[26] = tmp[10]*tmp[6];
	tmp[27] = -tmp[13]*tmp[3]*tmp[6] + tmp[18];
	tmp[28] = -tmp[27];
	tmp[29] = tmp[16]*tmp[1];
	tmp[30] = tmp[3]*tmp[9];
	tmp[31] = tmp[1]*tmp[24];
	tmp[32] = tanf(X[7]);
	tmp[33] = U[5] - X[13];
	tmp[34] = tmp[11]*tmp[33];
	tmp[35] = U[6] - X[14];
	tmp[36] = tmp[13]*tmp[35];
	tmp[37] = tmp[13]*tmp[33];
	tmp[38] = tmp[11]*tmp[35];
	tmp[39] = 1.0/tmp[1];
	tmp[40] = P[6]*dt;
	tmp[41] = P[9]*dt;
	tmp[42] = P[10]*dt;
	tmp[43] = P[13]*dt;
	tmp[44] = P[11]*dt;
	tmp[45] = P[14]*dt;
	tmp[46] = P[15]*dt;
	tmp[47] = P[18]*dt;
	tmp[48] = P[16]*dt;
	tmp[49] = P[19]*dt;
	tmp[50] = P[17]*dt;
	tmp[51] = P[20]*dt;
	tmp[52] = tmp[0]*tmp[1];
	tmp[53] = dt*tmp[52];
	tmp[54] = dt*tmp[15];
	tmp[55] = dt*tmp[20];
	tmp[56] = tmp[20]*tmp[2];
	tmp[57] = tmp[11]*tmp[1];
	tmp[58] = 6.0000000000000002e-5*tmp[57];
	tmp[59] = 6.0000000000000002e-5*tmp[0]*tmp[1]*tmp[2]*tmp[3] - tmp[56]*tmp[58];
	tmp[60] = 6.0000000000000002e-5*tmp[2];
	tmp[61] = powf(tmp[1], 2);
	tmp[62] = tmp[0]*tmp[61]*tmp[6];
	tmp[63] = -tmp[60]*tmp[62];
	tmp[64] = -6.0000000000000002e-5*tmp[14] - 6.0000000000000002e-5*tmp[22];
	tmp[65] = tmp[56]*tmp[64] + tmp[63];
	tmp[66] = powf(tmp[0], 2)*tmp[61];
	tmp[67] = 6.0000000000000002e-5*tmp[13]*tmp[6] - 6.0000000000000002e-5*tmp[19];
	tmp[68] = dt*(tmp[56]*tmp[67] - tmp[60]*tmp[66]) + 1;
	tmp[69] = -tmp[13]*tmp[21] - tmp[15]*tmp[4] - tmp[28]*tmp[7];
	tmp[70] = tmp[15]*tmp[24] - tmp[16]*tmp[20] + tmp[56]*tmp[69];
	tmp[71] = dt*tmp[70];
	tmp[72] = tmp[21] + tmp[3]*tmp[5] + tmp[3]*tmp[8];
	tmp[73] = tmp[2]*tmp[52];
	tmp[74] = 6.0000000000000002e-5*X[5]*tmp[11]*tmp[3] - tmp[12]*tmp[1]*tmp[7] - tmp[18]*tmp[1]*tmp[4];
	tmp[75] = -tmp[0]*tmp[30] + tmp[14]*tmp[29] + tmp[18]*tmp[31] + tmp[56]*tmp[74] + tmp[72]*tmp[73];
	tmp[76] = dt*tmp[75];
	tmp[77] = tmp[1]*tmp[6];
	tmp[78] = tmp[4]*tmp[77] - tmp[52]*tmp[7];
	tmp[79] = -tmp[23];
	tmp[80] = -tmp[20]*tmp[7] - tmp[4]*tmp[79];
	tmp[81] = tmp[16]*tmp[27] + tmp[24]*tmp[79] - tmp[26] + tmp[56]*tmp[80] + tmp[73]*tmp[78];
	tmp[82] = dt*tmp[81];
	tmp[83] = P[48]*dt;
	tmp[84] = P[69]*dt;
	tmp[85] = P[58]*dt;
	tmp[86] = P[24]*tmp[71] + P[31]*tmp[76] + P[39]*tmp[82] + P[9]*tmp[68] + tmp[15]*tmp[84] + tmp[20]*tmp[85] + tmp[43]*tmp[65] + tmp[47]*tmp[59] + tmp[52]*tmp[83];
	tmp[87] = P[49]*dt;
	tmp[88] = P[70]*dt;
	tmp[89] = P[59]*dt;
	tmp[90] = dt*(P[13]*tmp[68] + P[25]*tmp[71] + P[32]*tmp[76] + P[40]*tmp[82] + tmp[15]*tmp[88] + tmp[20]*tmp[89] + tmp[45]*tmp[65] + tmp[49]*tmp[59] + tmp[52]*tmp[87]);
	tmp[91] = dt*tmp[65];
	tmp[92] = P[50]*dt;
	tmp[93] = P[71]*dt;
	tmp[94] = P[60]*dt;
	tmp[95] = dt*(P[18]*tmp[68] + P[26]*tmp[71] + P[33]*tmp[76] + P[41]*tmp[82] + tmp[15]*tmp[93] + tmp[20]*tmp[94] + tmp[49]*tmp[65] + tmp[51]*tmp[59] + tmp[52]*tmp[92]);
	tmp[96] = powf(dt, 2);
	tmp[97] = Q[0]*tmp[96];
	tmp[98] = Q[2]*tmp[96];
	tmp[99] = Q[1]*tmp[96];
	tmp[100] = P[48]*tmp[68] + P[51]*tmp[71] + P[52]*tmp[76] + P[53]*tmp[82] + P[54]*tmp[53] + P[64]*tmp[55] + P[75]*tmp[54] + tmp[59]*tmp[92] + tmp[65]*tmp[87];
	tmp[101] = P[69]*tmp[68] + P[72]*tmp[71] + P[73]*tmp[76] + P[74]*tmp[82] + P[75]*tmp[53] + P[76]*tmp[55] + P[77]*tmp[54] + tmp[59]*tmp[93] + tmp[65]*tmp[88];
	tmp[102] = P[58]*tmp[68] + P[61]*tmp[71] + P[62]*tmp[76] + P[63]*tmp[82] + P[64]*tmp[53] + P[65]*tmp[55] + P[76]*tmp[54] + tmp[59]*tmp[94] + tmp[65]*tmp[89];
	tmp[103] = dt*tmp[59];
	tmp[104] = dt*tmp[77];
	tmp[105] = dt*tmp[23];
	tmp[106] = dt*tmp[28];
	tmp[107] = tmp[23]*tmp[2];
	tmp[108] = -tmp[107]*tmp[58] + 6.0000000000000002e-5*tmp[1]*tmp[2]*tmp[3]*tmp[6];
	tmp[109] = tmp[107]*tmp[67] + tmp[63];
	tmp[110] = tmp[61]*powf(tmp[6], 2);
	tmp[111] = dt*(tmp[107]*tmp[64] - tmp[110]*tmp[60]) + 1;
	tmp[112] = tmp[107]*tmp[69] + tmp[16]*tmp[79] + tmp[24]*tmp[28];
	tmp[113] = dt*tmp[112];
	tmp[114] = tmp[2]*tmp[77];
	tmp[115] = tmp[107]*tmp[74] + tmp[114]*tmp[72] + tmp[12]*tmp[31] + tmp[17]*tmp[29] - tmp[30]*tmp[6];
	tmp[116] = dt*tmp[115];
	tmp[117] = tmp[107]*tmp[80] + tmp[114]*tmp[78] + tmp[25];
	tmp[118] = dt*tmp[117];
	tmp[119] = P[13]*tmp[111] + P[24]*tmp[113] + P[31]*tmp[116] + P[39]*tmp[118] + tmp[108]*tmp[47] + tmp[109]*tmp[41] + tmp[23]*tmp[85] + tmp[28]*tmp[84] + tmp[77]*tmp[83];
	tmp[120] = dt*tmp[119];
	tmp[121] = dt*tmp[109];
	tmp[122] = P[14]*tmp[111] + P[25]*tmp[113] + P[32]*tmp[116] + P[40]*tmp[118] + tmp[108]*tmp[49] + tmp[109]*tmp[43] + tmp[23]*tmp[89] + tmp[28]*tmp[88] + tmp[77]*tmp[87];
	tmp[123] = dt*tmp[122];
	tmp[124] = dt*(P[19]*tmp[111] + P[26]*tmp[113] + P[33]*tmp[116] + P[41]*tmp[118] + tmp[108]*tmp[51] + tmp[109]*tmp[47] + tmp[23]*tmp[94] + tmp[28]*tmp[93] + tmp[77]*tmp[92]);
	tmp[125] = tmp[20]*tmp[99];
	tmp[126] = tmp[15]*tmp[98];
	tmp[127] = P[49]*tmp[111] + P[51]*tmp[113] + P[52]*tmp[116] + P[53]*tmp[118] + P[54]*tmp[104] + P[64]*tmp[105] + P[75]*tmp[106] + tmp[108]*tmp[92] + tmp[109]*tmp[83];
	tmp[128] = P[70]*tmp[111] + P[72]*tmp[113] + P[73]*tmp[116] + P[74]*tmp[118] + P[75]*tmp[104] + P[76]*tmp[105] + P[77]*tmp[106] + tmp[108]*tmp[93] + tmp[109]*tmp[84];
	tmp[129] = P[59]*tmp[111] + P[61]*tmp[113] + P[62]*tmp[116] + P[63]*tmp[118] + P[64]*tmp[104] + P[65]*tmp[105] + P[76]*tmp[106] + tmp[108]*tmp[94] + tmp[109]*tmp[85];
	tmp[130] = dt*tmp[108];
	tmp[131] = P[24]*tmp[121] + P[25]*tmp[111] + P[26]*tmp[130] + P[27]*tmp[113] + P[34]*tmp[116] + P[42]*tmp[118] + P[51]*tmp[104] + P[61]*tmp[105] + P[72]*tmp[106];
	tmp[132] = P[31]*tmp[121] + P[32]*tmp[111] + P[33]*tmp[130] + P[34]*tmp[113] + P[35]*tmp[116] + P[43]*tmp[118] + P[52]*tmp[104] + P[62]*tmp[105] + P[73]*tmp[106];
	tmp[133] = P[39]*tmp[121] + P[40]*tmp[111] + P[41]*tmp[130] + P[42]*tmp[113] + P[43]*tmp[116] + P[44]*tmp[118] + P[53]*tmp[104] + P[63]*tmp[105] + P[74]*tmp[106];
	tmp[134] = dt*tmp[3];
	tmp[135] = dt*tmp[11];
	tmp[136] = tmp[135]*tmp[1];
	tmp[137] = dt*tmp[13];
	tmp[138] = tmp[137]*tmp[1];
	tmp[139] = powf(tmp[3], 2);
	tmp[140] = powf(tmp[11], 2);
	tmp[141] = tmp[140]*tmp[61];
	tmp[142] = dt*(-tmp[139]*tmp[60] - tmp[141]*tmp[60]) + 1;
	tmp[143] = tmp[3]*tmp[60];
	tmp[144] = tmp[2]*tmp[57];
	tmp[145] = tmp[143]*tmp[77] + tmp[144]*tmp[64];
	tmp[146] = tmp[143]*tmp[52] + tmp[144]*tmp[67];
	tmp[147] = tmp[2]*tmp[3];
	tmp[148] = tmp[144]*tmp[80] - tmp[147]*tmp[78];
	tmp[149] = dt*tmp[148];
	tmp[150] = -tmp[11]*tmp[29] + tmp[13]*tmp[31] + tmp[144]*tmp[69];
	tmp[151] = dt*tmp[150];
	tmp[152] = -tmp[10] + tmp[11]*tmp[1]*tmp[2]*tmp[74] - tmp[11]*tmp[24]*tmp[3] - tmp[13]*tmp[16]*tmp[3] - tmp[147]*tmp[72];
	tmp[153] = dt*tmp[152];
	tmp[154] = tmp[13]*tmp[1];
	tmp[155] = P[18]*tmp[142] + P[24]*tmp[151] + P[31]*tmp[153] + P[39]*tmp[149] + tmp[145]*tmp[43] + tmp[146]*tmp[41] + tmp[154]*tmp[84] - tmp[3]*tmp[83] + tmp[57]*tmp[85];
	tmp[156] = dt*tmp[155];
	tmp[157] = dt*tmp[146];
	tmp[158] = P[19]*tmp[142] + P[25]*tmp[151] + P[32]*tmp[153] + P[40]*tmp[149] + tmp[145]*tmp[45] + tmp[146]*tmp[43] + tmp[154]*tmp[88] - tmp[3]*tmp[87] + tmp[57]*tmp[89];
	tmp[159] = dt*tmp[158];
	tmp[160] = dt*tmp[145];
	tmp[161] = P[20]*tmp[142] + P[26]*tmp[151] + P[33]*tmp[153] + P[41]*tmp[149] + tmp[145]*tmp[49] + tmp[146]*tmp[47] + tmp[154]*tmp[93] - tmp[3]*tmp[92] + tmp[57]*tmp[94];
	tmp[162] = dt*tmp[161];
	tmp[163] = tmp[3]*tmp[97];
	tmp[164] = P[50]*tmp[142] + P[51]*tmp[151] + P[52]*tmp[153] + P[53]*tmp[149] - P[54]*tmp[134] + P[64]*tmp[136] + P[75]*tmp[138] + tmp[145]*tmp[87] + tmp[146]*tmp[83];
	tmp[165] = P[71]*tmp[142] + P[72]*tmp[151] + P[73]*tmp[153] + P[74]*tmp[149] - P[75]*tmp[134] + P[76]*tmp[136] + P[77]*tmp[138] + tmp[145]*tmp[88] + tmp[146]*tmp[84];
	tmp[166] = P[60]*tmp[142] + P[61]*tmp[151] + P[62]*tmp[153] + P[63]*tmp[149] - P[64]*tmp[134] + P[65]*tmp[136] + P[76]*tmp[138] + tmp[145]*tmp[89] + tmp[146]*tmp[85];
	tmp[167] = P[24]*tmp[157] + P[25]*tmp[160] + P[26]*tmp[142] + P[27]*tmp[151] + P[34]*tmp[153] + P[42]*tmp[149] - P[51]*tmp[134] + P[61]*tmp[136] + P[72]*tmp[138];
	tmp[168] = P[31]*tmp[157] + P[32]*tmp[160] + P[33]*tmp[142] + P[34]*tmp[151] + P[35]*tmp[153] + P[43]*tmp[149] - P[52]*tmp[134] + P[62]*tmp[136] + P[73]*tmp[138];
	tmp[169] = P[39]*tmp[157] + P[40]*tmp[160] + P[41]*tmp[142] + P[42]*tmp[151] + P[43]*tmp[153] + P[44]*tmp[149] - P[53]*tmp[134] + P[63]*tmp[136] + P[74]*tmp[138];
	tmp[170] = powf(tmp[13], 2);
	tmp[171] = tmp[137]*tmp[32];
	tmp[172] = tmp[135]*tmp[32];
	tmp[173] = dt*(tmp[32]*tmp[37] - tmp[32]*tmp[38]) + 1;
	tmp[174] = powf(tmp[32], 2);
	tmp[175] = tmp[174] + 1;
	tmp[176] = tmp[175]*tmp[34] + tmp[175]*tmp[36];
	tmp[177] = P[81]*dt;
	tmp[178] = P[108]*dt;
	tmp[179] = tmp[13]*tmp[32];
	tmp[180] = P[94]*dt;
	tmp[181] = tmp[11]*tmp[32];
	tmp[182] = P[24]*tmp[173] + P[31]*dt*tmp[176] - tmp[177] - tmp[178]*tmp[179] - tmp[180]*tmp[181];
	tmp[183] = P[82]*dt;
	tmp[184] = P[109]*dt;
	tmp[185] = P[95]*dt;
	tmp[186] = P[25]*tmp[173] + P[32]*dt*tmp[176] - tmp[179]*tmp[184] - tmp[181]*tmp[185] - tmp[183];
	tmp[187] = P[83]*dt;
	tmp[188] = P[110]*dt;
	tmp[189] = P[96]*dt;
	tmp[190] = P[26]*tmp[173] + P[33]*dt*tmp[176] - tmp[179]*tmp[188] - tmp[181]*tmp[189] - tmp[187];
	tmp[191] = P[87]*dt;
	tmp[192] = -P[100]*tmp[172] - P[114]*tmp[171] + P[51]*tmp[173] + P[52]*dt*tmp[176] - tmp[191];
	tmp[193] = P[89]*dt;
	tmp[194] = -P[102]*tmp[172] - P[116]*tmp[171] + P[72]*tmp[173] + P[73]*dt*tmp[176] - tmp[193];
	tmp[195] = P[88]*dt;
	tmp[196] = -P[101]*tmp[172] - P[115]*tmp[171] + P[61]*tmp[173] + P[62]*dt*tmp[176] - tmp[195];
	tmp[197] = dt*tmp[190];
	tmp[198] = dt*tmp[186];
	tmp[199] = P[84]*dt;
	tmp[200] = -P[111]*tmp[171] + P[27]*tmp[173] + P[34]*dt*tmp[176] - P[97]*tmp[172] - tmp[199];
	tmp[201] = P[85]*dt;
	tmp[202] = -P[112]*tmp[171] + P[34]*tmp[173] + P[35]*dt*tmp[176] - P[98]*tmp[172] - tmp[201];
	tmp[203] = P[86]*dt;
	tmp[204] = -P[113]*tmp[171] + P[42]*tmp[173] + P[43]*dt*tmp[176] - P[99]*tmp[172] - tmp[203];
	tmp[205] = dt*tmp[182];
	tmp[206] = Q[4]*tmp[96];
	tmp[207] = tmp[140]*tmp[206];
	tmp[208] = Q[5]*tmp[96];
	tmp[209] = tmp[170]*tmp[208];
	tmp[210] = P[103]*dt;
	tmp[211] = P[117]*dt;
	tmp[212] = P[84]*tmp[173] + P[85]*dt*tmp[176] - P[90]*dt - tmp[179]*tmp[211] - tmp[181]*tmp[210];
	tmp[213] = P[118]*tmp[137];
	tmp[214] = -P[104]*tmp[172] + P[97]*tmp[173] + P[98]*dt*tmp[176] - tmp[210] - tmp[213]*tmp[32];
	tmp[215] = P[118]*tmp[135];
	tmp[216] = P[111]*tmp[173] + P[112]*dt*tmp[176] - P[119]*tmp[171] - tmp[211] - tmp[215]*tmp[32];
	tmp[217] = dt*tmp[176];
	tmp[218] = -tmp[34] - tmp[36];
	tmp[219] = dt*tmp[218];
	tmp[220] = P[24]*tmp[219] + P[31] + tmp[11]*tmp[178] - tmp[13]*tmp[180];
	tmp[221] = dt*tmp[220];
	tmp[222] = P[25]*tmp[219] + P[32] + tmp[11]*tmp[184] - tmp[13]*tmp[185];
	tmp[223] = dt*tmp[222];
	tmp[224] = P[26]*tmp[219] + P[33] + tmp[11]*tmp[188] - tmp[13]*tmp[189];
	tmp[225] = dt*tmp[224];
	tmp[226] = -P[100]*tmp[137] + P[114]*tmp[135] + P[51]*tmp[219] + P[52];
	tmp[227] = P[102]*tmp[137];
	tmp[228] = P[116]*tmp[135] + P[72]*tmp[219] + P[73] - tmp[227];
	tmp[229] = P[115]*tmp[135];
	tmp[230] = -P[101]*tmp[137] + P[61]*tmp[219] + P[62] + tmp[229];
	tmp[231] = P[111]*tmp[135] + P[27]*tmp[219] + P[34] - P[97]*tmp[137];
	tmp[232] = P[112]*tmp[135] + P[34]*tmp[219] + P[35] - P[98]*tmp[137];
	tmp[233] = P[113]*tmp[135] + P[42]*tmp[219] + P[43] - P[99]*tmp[137];
	tmp[234] = P[85] + tmp[11]*tmp[211] - tmp[13]*tmp[210] + tmp[199]*tmp[218];
	tmp[235] = -P[104]*tmp[137] + P[97]*tmp[219] + P[98] + tmp[215];
	tmp[236] = P[111]*tmp[219] + P[112] + P[119]*tmp[135] - tmp[213];
	tmp[237] = tmp[137]*tmp[39];
	tmp[238] = tmp[135]*tmp[39];
	tmp[239] = tmp[37]*tmp[39] - tmp[38]*tmp[39];
	tmp[240] = dt*tmp[239];
	tmp[241] = 1.0/tmp[61];
	tmp[242] = tmp[241]*tmp[3];
	tmp[243] = tmp[242]*tmp[34] + tmp[242]*tmp[36];
	tmp[244] = dt*tmp[243];
	tmp[245] = tmp[13]*tmp[39];
	tmp[246] = tmp[11]*tmp[39];
	tmp[247] = P[24]*tmp[240] + P[31]*tmp[244] + P[39] - tmp[178]*tmp[245] - tmp[180]*tmp[246];
	tmp[248] = dt*tmp[247];
	tmp[249] = P[25]*tmp[240] + P[32]*tmp[244] + P[40] - tmp[184]*tmp[245] - tmp[185]*tmp[246];
	tmp[250] = dt*tmp[249];
	tmp[251] = P[26]*tmp[240] + P[33]*tmp[244] + P[41] - tmp[188]*tmp[245] - tmp[189]*tmp[246];
	tmp[252] = dt*tmp[251];
	tmp[253] = -P[100]*tmp[238] - P[114]*tmp[237] + P[51]*tmp[240] + P[52]*tmp[244] + P[53];
	tmp[254] = -P[102]*tmp[238] - P[116]*tmp[237] + P[72]*tmp[240] + P[73]*tmp[244] + P[74];
	tmp[255] = -P[101]*tmp[238] - P[115]*tmp[237] + P[61]*tmp[240] + P[62]*tmp[244] + P[63];
	tmp[256] = -P[111]*tmp[237] + P[27]*tmp[240] + P[34]*tmp[244] + P[42] - P[97]*tmp[238];
	tmp[257] = -P[112]*tmp[237] + P[34]*tmp[240] + P[35]*tmp[244] + P[43] - P[98]*tmp[238];
	tmp[258] = -P[113]*tmp[237] + P[42]*tmp[240] + P[43]*tmp[244] + P[44] - P[99]*tmp[238];
	tmp[259] = tmp[32]*tmp[39];
	tmp[260] = P[86] + tmp[199]*tmp[239] + tmp[201]*tmp[243] - tmp[210]*tmp[246] - tmp[211]*tmp[245];
	tmp[261] = P[111]*tmp[240] + P[112]*tmp[244] + P[113] - P[119]*tmp[237] - tmp[215]*tmp[39];
	tmp[262] = -P[104]*tmp[238] + P[97]*tmp[240] + P[98]*tmp[244] + P[99] - tmp[213]*tmp[39];
	tmp[263] = tmp[11]*tmp[245];
	X_new[0] = X[0] + X[3]*dt;
	X_new[1] = X[1] + X[4]*dt;
	X_new[2] = X[2] + X[5]*dt;
	X_new[3] = X[3] + dt*tmp[25];
	X_new[4] = X[4] + dt*(tmp[16]*tmp[28] + tmp[23]*tmp[24] + tmp[26]);
	X_new[5] = X[5] + dt*(tmp[11]*tmp[31] + tmp[13]*tmp[29] - tmp[30] + 9.8100000000000005);
	X_new[6] = X[6] + dt*(U[4] - X[12] + tmp[32]*tmp[34] + tmp[32]*tmp[36]);
	X_new[7] = X[7] + dt*(tmp[37] - tmp[38]);
	X_new[8] = X[8] + dt*(tmp[34]*tmp[39] + tmp[36]*tmp[39]);
	X_new[9] = X[9];
	X_new[10] = X[10];
	X_new[11] = X[11];
	X_new[12] = X[12];
	X_new[13] = X[13];
	X_new[14] = X[14];
	P_new[0] = P[0] + dt*(P[6] + tmp[41]) + tmp[40];
	P_new[1] = P[1] + dt*(P[7] + tmp[43]) + tmp[42];
	P_new[2] = P[2] + dt*(P[11] + tmp[45]) + tmp[44];
	P_new[3] = P[3] + dt*(P[8] + tmp[47]) + tmp[46];
	P_new[4] = P[4] + dt*(P[12] + tmp[49]) + tmp[48];
	P_new[5] = P[5] + dt*(P[17] + tmp[51]) + tmp[50];
	P_new[6] = P[21]*tmp[71] + P[28]*tmp[76] + P[36]*tmp[82] + P[45]*tmp[53] + P[55]*tmp[55] + P[66]*tmp[54] + P[6]*tmp[68] + dt*tmp[86] + tmp[42]*tmp[65] + tmp[46]*tmp[59];
	P_new[7] = P[22]*tmp[71] + P[29]*tmp[76] + P[37]*tmp[82] + P[46]*tmp[53] + P[56]*tmp[55] + P[67]*tmp[54] + P[7]*tmp[68] + tmp[44]*tmp[65] + tmp[48]*tmp[59] + tmp[90];
	P_new[8] = P[12]*tmp[91] + P[23]*tmp[71] + P[30]*tmp[76] + P[38]*tmp[82] + P[47]*tmp[53] + P[57]*tmp[55] + P[68]*tmp[54] + P[8]*tmp[68] + tmp[50]*tmp[59] + tmp[95];
	P_new[9] = tmp[100]*tmp[53] + tmp[101]*tmp[54] + tmp[102]*tmp[55] + powf(tmp[15], 2)*tmp[98] + powf(tmp[20], 2)*tmp[99] + tmp[59]*tmp[95] + tmp[65]*tmp[90] + tmp[66]*tmp[97] + tmp[68]*tmp[86] + tmp[71]*(P[24]*tmp[68] + P[25]*tmp[91] + P[26]*tmp[103] + P[27]*tmp[71] + P[34]*tmp[76] + P[42]*tmp[82] + P[51]*tmp[53] + P[61]*tmp[55] + P[72]*tmp[54]) + tmp[76]*(P[31]*tmp[68] + P[32]*tmp[91] + P[33]*tmp[103] + P[34]*tmp[71] + P[35]*tmp[76] + P[43]*tmp[82] + P[52]*tmp[53] + P[62]*tmp[55] + P[73]*tmp[54]) + tmp[82]*(P[39]*tmp[68] + P[40]*tmp[91] + P[41]*tmp[103] + P[42]*tmp[71] + P[43]*tmp[76] + P[44]*tmp[82] + P[53]*tmp[53] + P[63]*tmp[55] + P[74]*tmp[54]);
	P_new[10] = P[10]*tmp[111] + P[21]*tmp[113] + P[28]*tmp[116] + P[36]*tmp[118] + P[45]*tmp[104] + P[55]*tmp[105] + P[66]*tmp[106] + tmp[108]*tmp[46] + tmp[109]*tmp[40] + tmp[120];
	P_new[11] = P[11]*tmp[111] + P[22]*tmp[113] + P[29]*tmp[116] + P[37]*tmp[118] + P[46]*tmp[104] + P[56]*tmp[105] + P[67]*tmp[106] + P[7]*tmp[121] + tmp[108]*tmp[48] + tmp[123];
	P_new[12] = P[12]*tmp[111] + P[23]*tmp[113] + P[30]*tmp[116] + P[38]*tmp[118] + P[47]*tmp[104] + P[57]*tmp[105] + P[68]*tmp[106] + P[8]*tmp[121] + tmp[108]*tmp[50] + tmp[124];
	P_new[13] = tmp[119]*tmp[68] + tmp[123]*tmp[65] + tmp[124]*tmp[59] + tmp[125]*tmp[23] + tmp[126]*tmp[28] + tmp[127]*tmp[53] + tmp[128]*tmp[54] + tmp[129]*tmp[55] + tmp[131]*tmp[71] + tmp[132]*tmp[76] + tmp[133]*tmp[82] + tmp[62]*tmp[97];
	P_new[14] = tmp[104]*tmp[127] + tmp[105]*tmp[129] + tmp[106]*tmp[128] + tmp[108]*tmp[124] + tmp[109]*tmp[120] + tmp[110]*tmp[97] + tmp[111]*tmp[122] + tmp[113]*tmp[131] + tmp[116]*tmp[132] + tmp[118]*tmp[133] + powf(tmp[23], 2)*tmp[99] + powf(tmp[28], 2)*tmp[98];
	P_new[15] = P[15]*tmp[142] + P[21]*tmp[151] + P[28]*tmp[153] + P[36]*tmp[149] - P[45]*tmp[134] + P[55]*tmp[136] + P[66]*tmp[138] + tmp[145]*tmp[42] + tmp[146]*tmp[40] + tmp[156];
	P_new[16] = P[16]*tmp[142] + P[22]*tmp[151] + P[29]*tmp[153] + P[37]*tmp[149] - P[46]*tmp[134] + P[56]*tmp[136] + P[67]*tmp[138] + P[7]*tmp[157] + tmp[145]*tmp[44] + tmp[159];
	P_new[17] = P[12]*tmp[160] + P[17]*tmp[142] + P[23]*tmp[151] + P[30]*tmp[153] + P[38]*tmp[149] - P[47]*tmp[134] + P[57]*tmp[136] + P[68]*tmp[138] + P[8]*tmp[157] + tmp[162];
	P_new[18] = tmp[125]*tmp[57] + tmp[126]*tmp[154] + tmp[155]*tmp[68] + tmp[159]*tmp[65] + tmp[162]*tmp[59] - tmp[163]*tmp[52] + tmp[164]*tmp[53] + tmp[165]*tmp[54] + tmp[166]*tmp[55] + tmp[167]*tmp[71] + tmp[168]*tmp[76] + tmp[169]*tmp[82];
	P_new[19] = tmp[104]*tmp[164] + tmp[105]*tmp[166] + tmp[106]*tmp[165] + tmp[108]*tmp[162] + tmp[109]*tmp[156] + tmp[111]*tmp[158] + tmp[113]*tmp[167] + tmp[116]*tmp[168] + tmp[118]*tmp[169] + tmp[154]*tmp[28]*tmp[98] - tmp[163]*tmp[77] + tmp[23]*tmp[57]*tmp[99];
	P_new[20] = -tmp[134]*tmp[164] + tmp[136]*tmp[166] + tmp[138]*tmp[165] + tmp[139]*tmp[97] + tmp[141]*tmp[99] + tmp[142]*tmp[161] + tmp[145]*tmp[159] + tmp[146]*tmp[156] + tmp[149]*tmp[169] + tmp[151]*tmp[167] + tmp[153]*tmp[168] + tmp[170]*tmp[61]*tmp[98];
	P_new[21] = -P[105]*tmp[171] + P[21]*tmp[173] + P[28]*dt*tmp[176] - P[78]*dt - P[91]*tmp[172] + dt*tmp[182];
	P_new[22] = -P[106]*tmp[171] + P[22]*tmp[173] + P[29]*dt*tmp[176] - P[79]*dt - P[92]*tmp[172] + dt*tmp[186];
	P_new[23] = -P[107]*tmp[171] + P[23]*tmp[173] + P[30]*dt*tmp[176] - P[80]*dt - P[93]*tmp[172] + dt*tmp[190];
	P_new[24] = tmp[182]*tmp[68] + tmp[192]*tmp[53] + tmp[194]*tmp[54] + tmp[196]*tmp[55] + tmp[197]*tmp[59] + tmp[198]*tmp[65] + tmp[200]*tmp[71] + tmp[202]*tmp[76] + tmp[204]*tmp[82];
	P_new[25] = tmp[104]*tmp[192] + tmp[105]*tmp[196] + tmp[106]*tmp[194] + tmp[108]*tmp[197] + tmp[109]*tmp[205] + tmp[111]*tmp[186] + tmp[113]*tmp[200] + tmp[116]*tmp[202] + tmp[118]*tmp[204];
	P_new[26] = -tmp[134]*tmp[192] + tmp[136]*tmp[196] + tmp[138]*tmp[194] + tmp[142]*tmp[190] + tmp[145]*tmp[198] + tmp[146]*tmp[205] + tmp[149]*tmp[204] + tmp[151]*tmp[200] + tmp[153]*tmp[202];
	P_new[27] = Q[3]*tmp[96] - dt*tmp[212] - tmp[171]*tmp[216] - tmp[172]*tmp[214] + tmp[173]*tmp[200] + tmp[174]*tmp[207] + tmp[174]*tmp[209] + tmp[202]*tmp[217];
	P_new[28] = P[105]*tmp[135] + P[21]*tmp[219] + P[28] - P[91]*tmp[137] + tmp[221];
	P_new[29] = P[106]*tmp[135] + P[22]*tmp[219] + P[29] - P[92]*tmp[137] + tmp[223];
	P_new[30] = P[107]*tmp[135] + P[23]*tmp[219] + P[30] - P[93]*tmp[137] + tmp[225];
	P_new[31] = tmp[220]*tmp[68] + tmp[223]*tmp[65] + tmp[225]*tmp[59] + tmp[226]*tmp[53] + tmp[228]*tmp[54] + tmp[230]*tmp[55] + tmp[231]*tmp[71] + tmp[232]*tmp[76] + tmp[233]*tmp[82];
	P_new[32] = tmp[104]*tmp[226] + tmp[105]*tmp[230] + tmp[106]*tmp[228] + tmp[108]*tmp[225] + tmp[109]*tmp[221] + tmp[111]*tmp[222] + tmp[113]*tmp[231] + tmp[116]*tmp[232] + tmp[118]*tmp[233];
	P_new[33] = -tmp[134]*tmp[226] + tmp[136]*tmp[230] + tmp[138]*tmp[228] + tmp[142]*tmp[224] + tmp[145]*tmp[223] + tmp[146]*tmp[221] + tmp[149]*tmp[233] + tmp[151]*tmp[231] + tmp[153]*tmp[232];
	P_new[34] = Q[4]*tmp[11]*tmp[13]*tmp[32]*tmp[96] + dt*tmp[176]*tmp[232] - dt*tmp[234] - tmp[11]*tmp[179]*tmp[208] - tmp[171]*tmp[236] - tmp[172]*tmp[235] + tmp[173]*tmp[231];
	P_new[35] = tmp[135]*tmp[236] - tmp[137]*tmp[235] + tmp[140]*tmp[208] + tmp[170]*tmp[206] + tmp[219]*tmp[231] + tmp[232];
	P_new[36] = -P[105]*tmp[237] + P[21]*tmp[240] + P[28]*tmp[244] + P[36] - P[91]*tmp[238] + tmp[248];
	P_new[37] = -P[106]*tmp[237] + P[22]*tmp[240] + P[29]*tmp[244] + P[37] - P[92]*tmp[238] + tmp[250];
	P_new[38] = -P[107]*tmp[237] + P[23]*tmp[240] + P[30]*tmp[244] + P[38] - P[93]*tmp[238] + tmp[252];
	P_new[39] = tmp[247]*tmp[68] + tmp[250]*tmp[65] + tmp[252]*tmp[59] + tmp[253]*tmp[53] + tmp[254]*tmp[54] + tmp[255]*tmp[55] + tmp[256]*tmp[71] + tmp[257]*tmp[76] + tmp[258]*tmp[82];
	P_new[40] = tmp[104]*tmp[253] + tmp[105]*tmp[255] + tmp[106]*tmp[254] + tmp[108]*tmp[252] + tmp[109]*tmp[248] + tmp[111]*tmp[249] + tmp[113]*tmp[256] + tmp[116]*tmp[257] + tmp[118]*tmp[258];
	P_new[41] = -tmp[134]*tmp[253] + tmp[136]*tmp[255] + tmp[138]*tmp[254] + tmp[142]*tmp[251] + tmp[145]*tmp[250] + tmp[146]*tmp[248] + tmp[149]*tmp[258] + tmp[151]*tmp[256] + tmp[153]*tmp[257];
	P_new[42] = -dt*tmp[260] - tmp[171]*tmp[261] - tmp[172]*tmp[262] + tmp[173]*tmp[256] + tmp[207]*tmp[259] + tmp[209]*tmp[259] + tmp[217]*tmp[257];
	P_new[43] = tmp[135]*tmp[261] - tmp[137]*tmp[262] + tmp[206]*tmp[263] - tmp[208]*tmp[263] + tmp[219]*tmp[256] + tmp[257];
	P_new[44] = tmp[207]*tmp[241] + tmp[209]*tmp[241] - tmp[237]*tmp[261] - tmp[238]*tmp[262] + tmp[240]*tmp[256] + tmp[244]*tmp[257] + tmp[258];
	P_new[45] = P[45] + tmp[83];
	P_new[46] = P[46] + tmp[87];
	P_new[47] = P[47] + tmp[92];
	P_new[48] = tmp[100];
	P_new[49] = tmp[127];
	P_new[50] = tmp[164];
	P_new[51] = tmp[192];
	P_new[52] = tmp[226];
	P_new[53] = tmp[253];
	P_new[54] = P[54];
	P_new[55] = P[55] + tmp[85];
	P_new[56] = P[56] + tmp[89];
	P_new[57] = P[57] + tmp[94];
	P_new[58] = tmp[102];
	P_new[59] = tmp[129];
	P_new[60] = tmp[166];
	P_new[61] = tmp[196];
	P_new[62] = tmp[230];
	P_new[63] = tmp[255];
	P_new[64] = P[64];
	P_new[65] = P[65];
	P_new[66] = P[66] + tmp[84];
	P_new[67] = P[67] + tmp[88];
	P_new[68] = P[68] + tmp[93];
	P_new[69] = tmp[101];
	P_new[70] = tmp[128];
	P_new[71] = tmp[165];
	P_new[72] = tmp[194];
	P_new[73] = tmp[228];
	P_new[74] = tmp[254];
	P_new[75] = P[75];
	P_new[76] = P[76];
	P_new[77] = P[77];
	P_new[78] = P[78] + tmp[177];
	P_new[79] = P[79] + tmp[183];
	P_new[80] = P[80] + tmp[187];
	P_new[81] = P[81]*tmp[68] + tmp[15]*tmp[193] + tmp[183]*tmp[65] + tmp[187]*tmp[59] + tmp[191]*tmp[52] + tmp[195]*tmp[20] + tmp[199]*tmp[70] + tmp[201]*tmp[75] + tmp[203]*tmp[81];
	P_new[82] = P[82]*tmp[111] + tmp[108]*tmp[187] + tmp[109]*tmp[177] + tmp[112]*tmp[199] + tmp[115]*tmp[201] + tmp[117]*tmp[203] + tmp[191]*tmp[77] + tmp[193]*tmp[28] + tmp[195]*tmp[23];
	P_new[83] = P[83]*tmp[142] + tmp[145]*tmp[183] + tmp[146]*tmp[177] + tmp[148]*tmp[203] + tmp[150]*tmp[199] + tmp[152]*tmp[201] + tmp[154]*tmp[193] - tmp[191]*tmp[3] + tmp[195]*tmp[57];
	P_new[84] = tmp[212];
	P_new[85] = tmp[234];
	P_new[86] = tmp[260];
	P_new[87] = P[87];
	P_new[88] = P[88];
	P_new[89] = P[89];
	P_new[90] = P[90];
	P_new[91] = P[91] + tmp[180];
	P_new[92] = P[92] + tmp[185];
	P_new[93] = P[93] + tmp[189];
	P_new[94] = P[100]*tmp[53] + P[101]*tmp[55] + P[102]*tmp[54] + P[94]*tmp[68] + P[97]*tmp[71] + P[98]*tmp[76] + P[99]*tmp[82] + tmp[185]*tmp[65] + tmp[189]*tmp[59];
	P_new[95] = P[100]*tmp[104] + P[101]*tmp[105] + P[102]*tmp[106] + P[95]*tmp[111] + P[97]*tmp[113] + P[98]*tmp[116] + P[99]*tmp[118] + tmp[108]*tmp[189] + tmp[109]*tmp[180];
	P_new[96] = -P[100]*tmp[134] + P[101]*tmp[136] + P[96]*tmp[142] + P[97]*tmp[151] + P[98]*tmp[153] + P[99]*tmp[149] + tmp[145]*tmp[185] + tmp[146]*tmp[180] + tmp[1]*tmp[227];
	P_new[97] = tmp[214];
	P_new[98] = tmp[235];
	P_new[99] = tmp[262];
	P_new[100] = P[100];
	P_new[101] = P[101];
	P_new[102] = P[102];
	P_new[103] = P[103];
	P_new[104] = P[104];
	P_new[105] = P[105] + tmp[178];
	P_new[106] = P[106] + tmp[184];
	P_new[107] = P[107] + tmp[188];
	P_new[108] = P[108]*tmp[68] + P[111]*tmp[71] + P[112]*tmp[76] + P[113]*tmp[82] + P[114]*tmp[53] + P[115]*tmp[55] + P[116]*tmp[54] + tmp[184]*tmp[65] + tmp[188]*tmp[59];
	P_new[109] = P[109]*tmp[111] + P[111]*tmp[113] + P[112]*tmp[116] + P[113]*tmp[118] + P[114]*tmp[104] + P[115]*tmp[105] + P[116]*tmp[106] + tmp[108]*tmp[188] + tmp[109]*tmp[178];
	P_new[110] = P[110]*tmp[142] + P[111]*tmp[151] + P[112]*tmp[153] + P[113]*tmp[149] - P[114]*tmp[134] + P[116]*tmp[138] + tmp[145]*tmp[184] + tmp[146]*tmp[178] + tmp[1]*tmp[229];
	P_new[111] = tmp[216];
	P_new[112] = tmp[236];
	P_new[113] = tmp[261];
	P_new[114] = P[114];
	P_new[115] = P[115];
	P_new[116] = P[116];
	P_new[117] = P[117];
	P_new[118] = P[118];
	P_new[119] = P[119];

    // swap X, X_new and P, P_new pointers
    swap_ptr = X;
    X = X_new;
    X_new = swap_ptr;

    swap_ptr = P;
    P = P_new;
    P_new = swap_ptr;
}

void ekf_update(float Z[N_MEASUREMENTS]) {
    // UPDATE STEP X_new, P_new = ...
    tmp[0] = -X[8]*ekf_use_psi + Z[5];
	tmp[1] = powf(ekf_use_psi, 2);
	tmp[2] = 1.0/(P[0] + R[0]);
	tmp[3] = 1.0/(-powf(P[1], 2)*tmp[2] + P[2] + R[1]);
	tmp[4] = P[1]*tmp[2];
	tmp[5] = P[36]*ekf_use_psi;
	tmp[6] = P[37]*ekf_use_psi - tmp[4]*tmp[5];
	tmp[7] = -P[3]*tmp[4] + P[4];
	tmp[8] = 1.0/(-powf(P[3], 2)*tmp[2] + P[5] + R[2] - tmp[3]*powf(tmp[7], 2));
	tmp[9] = P[3]*tmp[2];
	tmp[10] = tmp[3]*tmp[7];
	tmp[11] = P[38]*ekf_use_psi - tmp[10]*tmp[6] - tmp[5]*tmp[9];
	tmp[12] = powf(ekf_use_phi, 2);
	tmp[13] = P[21]*ekf_use_phi;
	tmp[14] = P[22]*ekf_use_phi - tmp[13]*tmp[4];
	tmp[15] = P[23]*ekf_use_phi - tmp[10]*tmp[14] - tmp[13]*tmp[9];
	tmp[16] = 1.0/(-powf(P[21], 2)*tmp[12]*tmp[2] + P[27]*tmp[12] + R[3] - powf(tmp[14], 2)*tmp[3] - powf(tmp[15], 2)*tmp[8]);
	tmp[17] = P[21]*tmp[2];
	tmp[18] = ekf_use_phi*tmp[17];
	tmp[19] = tmp[14]*tmp[3];
	tmp[20] = tmp[15]*tmp[8];
	tmp[21] = P[42]*ekf_use_phi*ekf_use_psi - tmp[11]*tmp[20] - tmp[18]*tmp[5] - tmp[19]*tmp[6];
	tmp[22] = powf(ekf_use_theta, 2);
	tmp[23] = P[28]*ekf_use_theta;
	tmp[24] = P[29]*ekf_use_theta - tmp[23]*tmp[4];
	tmp[25] = P[30]*ekf_use_theta - tmp[10]*tmp[24] - tmp[23]*tmp[9];
	tmp[26] = P[34]*ekf_use_phi*ekf_use_theta - tmp[18]*tmp[23] - tmp[19]*tmp[24] - tmp[20]*tmp[25];
	tmp[27] = 1.0/(-powf(P[28], 2)*tmp[22]*tmp[2] + P[35]*tmp[22] + R[4] - tmp[16]*powf(tmp[26], 2) - powf(tmp[24], 2)*tmp[3] - powf(tmp[25], 2)*tmp[8]);
	tmp[28] = P[28]*tmp[2];
	tmp[29] = ekf_use_theta*tmp[28];
	tmp[30] = tmp[24]*tmp[3];
	tmp[31] = tmp[25]*tmp[8];
	tmp[32] = tmp[16]*tmp[26];
	tmp[33] = P[43]*ekf_use_psi*ekf_use_theta - tmp[11]*tmp[31] - tmp[21]*tmp[32] - tmp[29]*tmp[5] - tmp[30]*tmp[6];
	tmp[34] = tmp[27]*powf(tmp[33], 2);
	tmp[35] = 1.0/(-powf(P[36], 2)*tmp[1]*tmp[2] + P[44]*tmp[1] + R[5] - powf(tmp[11], 2)*tmp[8] - tmp[16]*powf(tmp[21], 2) - tmp[34] - tmp[3]*powf(tmp[6], 2));
	tmp[36] = tmp[35]*tmp[5];
	tmp[37] = tmp[27]*tmp[33];
	tmp[38] = tmp[35]*tmp[37];
	tmp[39] = tmp[21]*tmp[35];
	tmp[40] = tmp[16]*(tmp[26]*tmp[38] - tmp[39]);
	tmp[41] = tmp[11]*tmp[35];
	tmp[42] = tmp[8]*(-tmp[15]*tmp[40] + tmp[25]*tmp[27]*tmp[33]*tmp[35] - tmp[41]);
	tmp[43] = tmp[35]*tmp[6];
	tmp[44] = -tmp[14]*tmp[40] + tmp[24]*tmp[27]*tmp[33]*tmp[35] - tmp[42]*tmp[7] - tmp[43];
	tmp[45] = P[1]*tmp[3];
	tmp[46] = P[3]*tmp[42] + tmp[13]*tmp[40] - tmp[23]*tmp[38] + tmp[36] + tmp[44]*tmp[45];
	tmp[47] = -tmp[46];
	tmp[48] = P[0]*tmp[2];
	tmp[49] = tmp[46] + tmp[47]*tmp[48];
	tmp[50] = -X[7]*ekf_use_theta + Z[4];
	tmp[51] = tmp[27]*(tmp[34]*tmp[35] + 1);
	tmp[52] = tmp[16]*(tmp[21]*tmp[27]*tmp[33]*tmp[35] - tmp[26]*tmp[51]);
	tmp[53] = tmp[8]*(tmp[11]*tmp[27]*tmp[33]*tmp[35] - tmp[15]*tmp[52] - tmp[25]*tmp[51]);
	tmp[54] = -tmp[14]*tmp[52] - tmp[24]*tmp[51] + tmp[27]*tmp[33]*tmp[35]*tmp[6] - tmp[53]*tmp[7];
	tmp[55] = P[3]*tmp[53] + tmp[13]*tmp[52] + tmp[23]*tmp[51] - tmp[36]*tmp[37] + tmp[45]*tmp[54];
	tmp[56] = -tmp[55];
	tmp[57] = tmp[48]*tmp[56] + tmp[55];
	tmp[58] = -X[6]*ekf_use_phi + Z[3];
	tmp[59] = tmp[16]*tmp[21];
	tmp[60] = tmp[32]*tmp[37] - tmp[59];
	tmp[61] = tmp[33]*tmp[35];
	tmp[62] = tmp[27]*(-tmp[32] - tmp[60]*tmp[61]);
	tmp[63] = tmp[16]*(-tmp[26]*tmp[62] - tmp[39]*tmp[60] + 1);
	tmp[64] = tmp[8]*(-tmp[15]*tmp[63] - tmp[25]*tmp[62] - tmp[41]*tmp[60]);
	tmp[65] = -tmp[14]*tmp[63] - tmp[24]*tmp[62] - tmp[43]*tmp[60] - tmp[64]*tmp[7];
	tmp[66] = P[3]*tmp[64] + tmp[13]*tmp[63] + tmp[23]*tmp[62] + tmp[36]*tmp[60] + tmp[45]*tmp[65];
	tmp[67] = -tmp[66];
	tmp[68] = tmp[48]*tmp[67] + tmp[66];
	tmp[69] = -X[2] + Z[2];
	tmp[70] = tmp[11]*tmp[8];
	tmp[71] = tmp[15]*tmp[16]*tmp[21]*tmp[8] - tmp[37]*(tmp[20]*tmp[32] - tmp[31]) - tmp[70];
	tmp[72] = tmp[27]*(tmp[15]*tmp[16]*tmp[26]*tmp[8] - tmp[31] - tmp[61]*tmp[71]);
	tmp[73] = tmp[16]*(-tmp[20] - tmp[26]*tmp[72] - tmp[39]*tmp[71]);
	tmp[74] = tmp[8]*(-tmp[15]*tmp[73] - tmp[25]*tmp[72] - tmp[41]*tmp[71] + 1);
	tmp[75] = -tmp[14]*tmp[73] - tmp[24]*tmp[72] - tmp[43]*tmp[71] - tmp[74]*tmp[7];
	tmp[76] = P[3]*tmp[74] + tmp[13]*tmp[73] + tmp[23]*tmp[72] + tmp[36]*tmp[71] + tmp[45]*tmp[75];
	tmp[77] = -tmp[76];
	tmp[78] = tmp[48]*tmp[77] + tmp[76];
	tmp[79] = -X[1] + Z[1];
	tmp[80] = tmp[10]*tmp[20] - tmp[19];
	tmp[81] = -tmp[25]*tmp[3]*tmp[7]*tmp[8] + tmp[30] + tmp[32]*tmp[80];
	tmp[82] = tmp[11]*tmp[3]*tmp[7]*tmp[8] + tmp[37]*tmp[81] - tmp[3]*tmp[6] - tmp[59]*tmp[80];
	tmp[83] = tmp[27]*(-tmp[61]*tmp[82] - tmp[81]);
	tmp[84] = tmp[16]*(tmp[15]*tmp[3]*tmp[7]*tmp[8] - tmp[19] - tmp[26]*tmp[83] - tmp[39]*tmp[82]);
	tmp[85] = tmp[8]*(-tmp[10] - tmp[15]*tmp[84] - tmp[25]*tmp[83] - tmp[41]*tmp[82]);
	tmp[86] = -tmp[14]*tmp[84] - tmp[24]*tmp[83] - tmp[43]*tmp[82] - tmp[7]*tmp[85] + 1;
	tmp[87] = P[3]*tmp[85] + tmp[13]*tmp[84] + tmp[23]*tmp[83] + tmp[36]*tmp[82] + tmp[45]*tmp[86];
	tmp[88] = -tmp[87];
	tmp[89] = tmp[48]*tmp[88] + tmp[87];
	tmp[90] = -X[0] + Z[0];
	tmp[91] = tmp[10]*tmp[4] - tmp[9];
	tmp[92] = -P[1]*tmp[14]*tmp[2]*tmp[3] + tmp[18] + tmp[20]*tmp[91];
	tmp[93] = -tmp[92];
	tmp[94] = -P[1]*tmp[24]*tmp[2]*tmp[3] + tmp[29] + tmp[31]*tmp[91] + tmp[32]*tmp[93];
	tmp[95] = P[1]*tmp[2]*tmp[3]*tmp[6] - tmp[2]*tmp[5] + tmp[37]*tmp[94] - tmp[59]*tmp[93] - tmp[70]*tmp[91];
	tmp[96] = tmp[27]*(-tmp[61]*tmp[95] - tmp[94]);
	tmp[97] = tmp[16]*(-tmp[26]*tmp[96] - tmp[39]*tmp[95] - tmp[92]);
	tmp[98] = tmp[8]*(P[1]*tmp[2]*tmp[3]*tmp[7] - tmp[15]*tmp[97] - tmp[25]*tmp[96] - tmp[41]*tmp[95] - tmp[9]);
	tmp[99] = -tmp[14]*tmp[97] - tmp[24]*tmp[96] - tmp[43]*tmp[95] - tmp[4] - tmp[7]*tmp[98];
	tmp[100] = P[3]*tmp[98] + tmp[13]*tmp[97] + tmp[23]*tmp[96] + tmp[36]*tmp[95] + tmp[45]*tmp[99];
	tmp[101] = tmp[100] - 1;
	tmp[102] = -tmp[101];
	tmp[103] = tmp[102]*tmp[48];
	tmp[104] = P[37]*ekf_use_psi;
	tmp[105] = tmp[104]*tmp[35];
	tmp[106] = P[29]*ekf_use_theta;
	tmp[107] = P[22]*ekf_use_phi;
	tmp[108] = P[2]*tmp[3];
	tmp[109] = P[4]*tmp[42] + tmp[105] - tmp[106]*tmp[38] + tmp[107]*tmp[40] + tmp[108]*tmp[44] + tmp[47]*tmp[4];
	tmp[110] = P[4]*tmp[53] - tmp[105]*tmp[37] + tmp[106]*tmp[51] + tmp[107]*tmp[52] + tmp[108]*tmp[54] + tmp[4]*tmp[56];
	tmp[111] = P[4]*tmp[64] + tmp[105]*tmp[60] + tmp[106]*tmp[62] + tmp[107]*tmp[63] + tmp[108]*tmp[65] + tmp[4]*tmp[67];
	tmp[112] = P[4]*tmp[74] + tmp[105]*tmp[71] + tmp[106]*tmp[72] + tmp[107]*tmp[73] + tmp[108]*tmp[75] + tmp[4]*tmp[77];
	tmp[113] = P[4]*tmp[85] + tmp[105]*tmp[82] + tmp[106]*tmp[83] + tmp[107]*tmp[84] + tmp[108]*tmp[86] + tmp[4]*tmp[88];
	tmp[114] = P[4]*tmp[98] + tmp[102]*tmp[4] + tmp[105]*tmp[95] + tmp[106]*tmp[96] + tmp[107]*tmp[97] + tmp[108]*tmp[99];
	tmp[115] = P[38]*ekf_use_psi;
	tmp[116] = tmp[115]*tmp[35];
	tmp[117] = P[30]*ekf_use_theta;
	tmp[118] = P[23]*ekf_use_phi;
	tmp[119] = P[4]*tmp[3];
	tmp[120] = P[5]*tmp[42] + tmp[116] - tmp[117]*tmp[38] + tmp[118]*tmp[40] + tmp[119]*tmp[44] + tmp[47]*tmp[9];
	tmp[121] = P[5]*tmp[53] - tmp[116]*tmp[37] + tmp[117]*tmp[51] + tmp[118]*tmp[52] + tmp[119]*tmp[54] + tmp[56]*tmp[9];
	tmp[122] = P[5]*tmp[64] + tmp[116]*tmp[60] + tmp[117]*tmp[62] + tmp[118]*tmp[63] + tmp[119]*tmp[65] + tmp[67]*tmp[9];
	tmp[123] = P[5]*tmp[74] + tmp[116]*tmp[71] + tmp[117]*tmp[72] + tmp[118]*tmp[73] + tmp[119]*tmp[75] + tmp[77]*tmp[9];
	tmp[124] = P[5]*tmp[85] + tmp[116]*tmp[82] + tmp[117]*tmp[83] + tmp[118]*tmp[84] + tmp[119]*tmp[86] + tmp[88]*tmp[9];
	tmp[125] = P[5]*tmp[98] + tmp[102]*tmp[9] + tmp[116]*tmp[95] + tmp[117]*tmp[96] + tmp[118]*tmp[97] + tmp[119]*tmp[99];
	tmp[126] = ekf_use_psi*tmp[35];
	tmp[127] = P[39]*tmp[126];
	tmp[128] = P[31]*ekf_use_theta;
	tmp[129] = P[24]*ekf_use_phi;
	tmp[130] = P[7]*tmp[3];
	tmp[131] = P[6]*tmp[2];
	tmp[132] = P[8]*tmp[42] + tmp[127] - tmp[128]*tmp[38] + tmp[129]*tmp[40] + tmp[130]*tmp[44] + tmp[131]*tmp[47];
	tmp[133] = P[8]*tmp[53] - tmp[127]*tmp[37] + tmp[128]*tmp[51] + tmp[129]*tmp[52] + tmp[130]*tmp[54] + tmp[131]*tmp[56];
	tmp[134] = P[8]*tmp[64] + tmp[127]*tmp[60] + tmp[128]*tmp[62] + tmp[129]*tmp[63] + tmp[130]*tmp[65] + tmp[131]*tmp[67];
	tmp[135] = P[8]*tmp[74] + tmp[127]*tmp[71] + tmp[128]*tmp[72] + tmp[129]*tmp[73] + tmp[130]*tmp[75] + tmp[131]*tmp[77];
	tmp[136] = P[8]*tmp[85] + tmp[127]*tmp[82] + tmp[128]*tmp[83] + tmp[129]*tmp[84] + tmp[130]*tmp[86] + tmp[131]*tmp[88];
	tmp[137] = P[8]*tmp[98] + tmp[102]*tmp[131] + tmp[127]*tmp[95] + tmp[128]*tmp[96] + tmp[129]*tmp[97] + tmp[130]*tmp[99];
	tmp[138] = P[40]*tmp[126];
	tmp[139] = P[32]*ekf_use_theta;
	tmp[140] = P[25]*ekf_use_phi;
	tmp[141] = P[11]*tmp[3];
	tmp[142] = P[10]*tmp[2];
	tmp[143] = P[12]*tmp[42] + tmp[138] - tmp[139]*tmp[38] + tmp[140]*tmp[40] + tmp[141]*tmp[44] + tmp[142]*tmp[47];
	tmp[144] = P[12]*tmp[53] - tmp[138]*tmp[37] + tmp[139]*tmp[51] + tmp[140]*tmp[52] + tmp[141]*tmp[54] + tmp[142]*tmp[56];
	tmp[145] = P[12]*tmp[64] + tmp[138]*tmp[60] + tmp[139]*tmp[62] + tmp[140]*tmp[63] + tmp[141]*tmp[65] + tmp[142]*tmp[67];
	tmp[146] = P[12]*tmp[74] + tmp[138]*tmp[71] + tmp[139]*tmp[72] + tmp[140]*tmp[73] + tmp[141]*tmp[75] + tmp[142]*tmp[77];
	tmp[147] = P[12]*tmp[85] + tmp[138]*tmp[82] + tmp[139]*tmp[83] + tmp[140]*tmp[84] + tmp[141]*tmp[86] + tmp[142]*tmp[88];
	tmp[148] = P[12]*tmp[98] + tmp[102]*tmp[142] + tmp[138]*tmp[95] + tmp[139]*tmp[96] + tmp[140]*tmp[97] + tmp[141]*tmp[99];
	tmp[149] = P[41]*tmp[126];
	tmp[150] = P[33]*ekf_use_theta;
	tmp[151] = P[26]*ekf_use_phi;
	tmp[152] = P[16]*tmp[3];
	tmp[153] = P[15]*tmp[2];
	tmp[154] = P[17]*tmp[42] + tmp[149] - tmp[150]*tmp[38] + tmp[151]*tmp[40] + tmp[152]*tmp[44] + tmp[153]*tmp[47];
	tmp[155] = P[17]*tmp[53] - tmp[149]*tmp[37] + tmp[150]*tmp[51] + tmp[151]*tmp[52] + tmp[152]*tmp[54] + tmp[153]*tmp[56];
	tmp[156] = P[17]*tmp[64] + tmp[149]*tmp[60] + tmp[150]*tmp[62] + tmp[151]*tmp[63] + tmp[152]*tmp[65] + tmp[153]*tmp[67];
	tmp[157] = P[17]*tmp[74] + tmp[149]*tmp[71] + tmp[150]*tmp[72] + tmp[151]*tmp[73] + tmp[152]*tmp[75] + tmp[153]*tmp[77];
	tmp[158] = P[17]*tmp[85] + tmp[149]*tmp[82] + tmp[150]*tmp[83] + tmp[151]*tmp[84] + tmp[152]*tmp[86] + tmp[153]*tmp[88];
	tmp[159] = P[17]*tmp[98] + tmp[102]*tmp[153] + tmp[149]*tmp[95] + tmp[150]*tmp[96] + tmp[151]*tmp[97] + tmp[152]*tmp[99];
	tmp[160] = P[42]*ekf_use_psi;
	tmp[161] = tmp[160]*tmp[35];
	tmp[162] = P[34]*ekf_use_theta;
	tmp[163] = P[27]*ekf_use_phi;
	tmp[164] = P[22]*tmp[3];
	tmp[165] = P[23]*tmp[42] + tmp[161] - tmp[162]*tmp[38] + tmp[163]*tmp[40] + tmp[164]*tmp[44] + tmp[17]*tmp[47];
	tmp[166] = P[23]*tmp[53] - tmp[161]*tmp[37] + tmp[162]*tmp[51] + tmp[163]*tmp[52] + tmp[164]*tmp[54] + tmp[17]*tmp[56];
	tmp[167] = P[23]*tmp[64] + tmp[161]*tmp[60] + tmp[162]*tmp[62] + tmp[163]*tmp[63] + tmp[164]*tmp[65] + tmp[17]*tmp[67];
	tmp[168] = P[23]*tmp[74] + tmp[161]*tmp[71] + tmp[162]*tmp[72] + tmp[163]*tmp[73] + tmp[164]*tmp[75] + tmp[17]*tmp[77];
	tmp[169] = P[23]*tmp[85] + tmp[161]*tmp[82] + tmp[162]*tmp[83] + tmp[163]*tmp[84] + tmp[164]*tmp[86] + tmp[17]*tmp[88];
	tmp[170] = P[23]*tmp[98] + tmp[102]*tmp[17] + tmp[161]*tmp[95] + tmp[162]*tmp[96] + tmp[163]*tmp[97] + tmp[164]*tmp[99];
	tmp[171] = P[43]*ekf_use_psi;
	tmp[172] = tmp[171]*tmp[35];
	tmp[173] = P[35]*ekf_use_theta;
	tmp[174] = P[34]*ekf_use_phi;
	tmp[175] = P[29]*tmp[3];
	tmp[176] = P[30]*tmp[42] + tmp[172] - tmp[173]*tmp[38] + tmp[174]*tmp[40] + tmp[175]*tmp[44] + tmp[28]*tmp[47];
	tmp[177] = P[30]*tmp[53] - tmp[172]*tmp[37] + tmp[173]*tmp[51] + tmp[174]*tmp[52] + tmp[175]*tmp[54] + tmp[28]*tmp[56];
	tmp[178] = P[30]*tmp[64] + tmp[172]*tmp[60] + tmp[173]*tmp[62] + tmp[174]*tmp[63] + tmp[175]*tmp[65] + tmp[28]*tmp[67];
	tmp[179] = P[30]*tmp[74] + tmp[172]*tmp[71] + tmp[173]*tmp[72] + tmp[174]*tmp[73] + tmp[175]*tmp[75] + tmp[28]*tmp[77];
	tmp[180] = P[30]*tmp[85] + tmp[172]*tmp[82] + tmp[173]*tmp[83] + tmp[174]*tmp[84] + tmp[175]*tmp[86] + tmp[28]*tmp[88];
	tmp[181] = P[30]*tmp[98] + tmp[102]*tmp[28] + tmp[172]*tmp[95] + tmp[173]*tmp[96] + tmp[174]*tmp[97] + tmp[175]*tmp[99];
	tmp[182] = P[44]*tmp[126];
	tmp[183] = P[43]*ekf_use_theta;
	tmp[184] = P[42]*ekf_use_phi;
	tmp[185] = P[37]*tmp[3];
	tmp[186] = P[36]*tmp[2];
	tmp[187] = P[38]*tmp[42] + tmp[182] - tmp[183]*tmp[38] + tmp[184]*tmp[40] + tmp[185]*tmp[44] + tmp[186]*tmp[47];
	tmp[188] = P[38]*tmp[53] - tmp[182]*tmp[37] + tmp[183]*tmp[51] + tmp[184]*tmp[52] + tmp[185]*tmp[54] + tmp[186]*tmp[56];
	tmp[189] = P[38]*tmp[64] + tmp[182]*tmp[60] + tmp[183]*tmp[62] + tmp[184]*tmp[63] + tmp[185]*tmp[65] + tmp[186]*tmp[67];
	tmp[190] = P[38]*tmp[74] + tmp[182]*tmp[71] + tmp[183]*tmp[72] + tmp[184]*tmp[73] + tmp[185]*tmp[75] + tmp[186]*tmp[77];
	tmp[191] = P[38]*tmp[85] + tmp[182]*tmp[82] + tmp[183]*tmp[83] + tmp[184]*tmp[84] + tmp[185]*tmp[86] + tmp[186]*tmp[88];
	tmp[192] = P[38]*tmp[98] + tmp[102]*tmp[186] + tmp[182]*tmp[95] + tmp[183]*tmp[96] + tmp[184]*tmp[97] + tmp[185]*tmp[99];
	tmp[193] = P[53]*tmp[126];
	tmp[194] = P[52]*ekf_use_theta;
	tmp[195] = P[51]*ekf_use_phi;
	tmp[196] = P[46]*tmp[3];
	tmp[197] = P[45]*tmp[2];
	tmp[198] = P[47]*tmp[42] + tmp[193] - tmp[194]*tmp[38] + tmp[195]*tmp[40] + tmp[196]*tmp[44] + tmp[197]*tmp[47];
	tmp[199] = P[47]*tmp[53] - tmp[193]*tmp[37] + tmp[194]*tmp[51] + tmp[195]*tmp[52] + tmp[196]*tmp[54] + tmp[197]*tmp[56];
	tmp[200] = P[47]*tmp[64] + tmp[193]*tmp[60] + tmp[194]*tmp[62] + tmp[195]*tmp[63] + tmp[196]*tmp[65] + tmp[197]*tmp[67];
	tmp[201] = P[47]*tmp[74] + tmp[193]*tmp[71] + tmp[194]*tmp[72] + tmp[195]*tmp[73] + tmp[196]*tmp[75] + tmp[197]*tmp[77];
	tmp[202] = P[47]*tmp[85] + tmp[193]*tmp[82] + tmp[194]*tmp[83] + tmp[195]*tmp[84] + tmp[196]*tmp[86] + tmp[197]*tmp[88];
	tmp[203] = P[47]*tmp[98] + tmp[102]*tmp[197] + tmp[193]*tmp[95] + tmp[194]*tmp[96] + tmp[195]*tmp[97] + tmp[196]*tmp[99];
	tmp[204] = P[63]*tmp[126];
	tmp[205] = P[62]*ekf_use_theta;
	tmp[206] = P[61]*ekf_use_phi;
	tmp[207] = P[56]*tmp[3];
	tmp[208] = P[55]*tmp[2];
	tmp[209] = P[57]*tmp[42] + tmp[204] - tmp[205]*tmp[38] + tmp[206]*tmp[40] + tmp[207]*tmp[44] + tmp[208]*tmp[47];
	tmp[210] = P[57]*tmp[53] - tmp[204]*tmp[37] + tmp[205]*tmp[51] + tmp[206]*tmp[52] + tmp[207]*tmp[54] + tmp[208]*tmp[56];
	tmp[211] = P[57]*tmp[64] + tmp[204]*tmp[60] + tmp[205]*tmp[62] + tmp[206]*tmp[63] + tmp[207]*tmp[65] + tmp[208]*tmp[67];
	tmp[212] = P[57]*tmp[74] + tmp[204]*tmp[71] + tmp[205]*tmp[72] + tmp[206]*tmp[73] + tmp[207]*tmp[75] + tmp[208]*tmp[77];
	tmp[213] = P[57]*tmp[85] + tmp[204]*tmp[82] + tmp[205]*tmp[83] + tmp[206]*tmp[84] + tmp[207]*tmp[86] + tmp[208]*tmp[88];
	tmp[214] = P[57]*tmp[98] + tmp[102]*tmp[208] + tmp[204]*tmp[95] + tmp[205]*tmp[96] + tmp[206]*tmp[97] + tmp[207]*tmp[99];
	tmp[215] = P[74]*tmp[126];
	tmp[216] = P[73]*ekf_use_theta;
	tmp[217] = P[72]*ekf_use_phi;
	tmp[218] = P[67]*tmp[3];
	tmp[219] = P[66]*tmp[2];
	tmp[220] = P[68]*tmp[42] + tmp[215] - tmp[216]*tmp[38] + tmp[217]*tmp[40] + tmp[218]*tmp[44] + tmp[219]*tmp[47];
	tmp[221] = P[68]*tmp[53] - tmp[215]*tmp[37] + tmp[216]*tmp[51] + tmp[217]*tmp[52] + tmp[218]*tmp[54] + tmp[219]*tmp[56];
	tmp[222] = P[68]*tmp[64] + tmp[215]*tmp[60] + tmp[216]*tmp[62] + tmp[217]*tmp[63] + tmp[218]*tmp[65] + tmp[219]*tmp[67];
	tmp[223] = P[68]*tmp[74] + tmp[215]*tmp[71] + tmp[216]*tmp[72] + tmp[217]*tmp[73] + tmp[218]*tmp[75] + tmp[219]*tmp[77];
	tmp[224] = P[68]*tmp[85] + tmp[215]*tmp[82] + tmp[216]*tmp[83] + tmp[217]*tmp[84] + tmp[218]*tmp[86] + tmp[219]*tmp[88];
	tmp[225] = P[68]*tmp[98] + tmp[102]*tmp[219] + tmp[215]*tmp[95] + tmp[216]*tmp[96] + tmp[217]*tmp[97] + tmp[218]*tmp[99];
	tmp[226] = P[86]*tmp[126];
	tmp[227] = P[85]*ekf_use_theta;
	tmp[228] = P[84]*ekf_use_phi;
	tmp[229] = P[79]*tmp[3];
	tmp[230] = P[78]*tmp[2];
	tmp[231] = P[80]*tmp[42] + tmp[226] - tmp[227]*tmp[38] + tmp[228]*tmp[40] + tmp[229]*tmp[44] + tmp[230]*tmp[47];
	tmp[232] = P[80]*tmp[53] - tmp[226]*tmp[37] + tmp[227]*tmp[51] + tmp[228]*tmp[52] + tmp[229]*tmp[54] + tmp[230]*tmp[56];
	tmp[233] = P[80]*tmp[64] + tmp[226]*tmp[60] + tmp[227]*tmp[62] + tmp[228]*tmp[63] + tmp[229]*tmp[65] + tmp[230]*tmp[67];
	tmp[234] = P[80]*tmp[74] + tmp[226]*tmp[71] + tmp[227]*tmp[72] + tmp[228]*tmp[73] + tmp[229]*tmp[75] + tmp[230]*tmp[77];
	tmp[235] = P[80]*tmp[85] + tmp[226]*tmp[82] + tmp[227]*tmp[83] + tmp[228]*tmp[84] + tmp[229]*tmp[86] + tmp[230]*tmp[88];
	tmp[236] = P[80]*tmp[98] + tmp[102]*tmp[230] + tmp[226]*tmp[95] + tmp[227]*tmp[96] + tmp[228]*tmp[97] + tmp[229]*tmp[99];
	tmp[237] = P[99]*tmp[126];
	tmp[238] = P[98]*ekf_use_theta;
	tmp[239] = P[97]*ekf_use_phi;
	tmp[240] = P[92]*tmp[3];
	tmp[241] = P[91]*tmp[2];
	tmp[242] = P[93]*tmp[42] + tmp[237] - tmp[238]*tmp[38] + tmp[239]*tmp[40] + tmp[240]*tmp[44] + tmp[241]*tmp[47];
	tmp[243] = P[93]*tmp[53] - tmp[237]*tmp[37] + tmp[238]*tmp[51] + tmp[239]*tmp[52] + tmp[240]*tmp[54] + tmp[241]*tmp[56];
	tmp[244] = P[93]*tmp[64] + tmp[237]*tmp[60] + tmp[238]*tmp[62] + tmp[239]*tmp[63] + tmp[240]*tmp[65] + tmp[241]*tmp[67];
	tmp[245] = P[93]*tmp[74] + tmp[237]*tmp[71] + tmp[238]*tmp[72] + tmp[239]*tmp[73] + tmp[240]*tmp[75] + tmp[241]*tmp[77];
	tmp[246] = P[93]*tmp[85] + tmp[237]*tmp[82] + tmp[238]*tmp[83] + tmp[239]*tmp[84] + tmp[240]*tmp[86] + tmp[241]*tmp[88];
	tmp[247] = P[93]*tmp[98] + tmp[102]*tmp[241] + tmp[237]*tmp[95] + tmp[238]*tmp[96] + tmp[239]*tmp[97] + tmp[240]*tmp[99];
	tmp[248] = P[113]*tmp[126];
	tmp[249] = P[112]*ekf_use_theta;
	tmp[250] = P[111]*ekf_use_phi;
	tmp[251] = P[106]*tmp[3];
	tmp[252] = P[105]*tmp[2];
	tmp[253] = P[107]*tmp[42] + tmp[248] - tmp[249]*tmp[38] + tmp[250]*tmp[40] + tmp[251]*tmp[44] + tmp[252]*tmp[47];
	tmp[254] = P[107]*tmp[53] - tmp[248]*tmp[37] + tmp[249]*tmp[51] + tmp[250]*tmp[52] + tmp[251]*tmp[54] + tmp[252]*tmp[56];
	tmp[255] = P[107]*tmp[64] + tmp[248]*tmp[60] + tmp[249]*tmp[62] + tmp[250]*tmp[63] + tmp[251]*tmp[65] + tmp[252]*tmp[67];
	tmp[256] = P[107]*tmp[74] + tmp[248]*tmp[71] + tmp[249]*tmp[72] + tmp[250]*tmp[73] + tmp[251]*tmp[75] + tmp[252]*tmp[77];
	tmp[257] = P[107]*tmp[85] + tmp[248]*tmp[82] + tmp[249]*tmp[83] + tmp[250]*tmp[84] + tmp[251]*tmp[86] + tmp[252]*tmp[88];
	tmp[258] = P[107]*tmp[98] + tmp[102]*tmp[252] + tmp[248]*tmp[95] + tmp[249]*tmp[96] + tmp[250]*tmp[97] + tmp[251]*tmp[99];
	tmp[259] = -tmp[112];
	tmp[260] = 1 - tmp[113];
	tmp[261] = -tmp[114];
	tmp[262] = 1 - tmp[123];
	tmp[263] = -tmp[124];
	tmp[264] = -tmp[125];
	tmp[265] = -tmp[135];
	tmp[266] = -tmp[136];
	tmp[267] = -tmp[137];
	tmp[268] = P[39]*ekf_use_psi;
	tmp[269] = -tmp[146];
	tmp[270] = -tmp[147];
	tmp[271] = -tmp[148];
	tmp[272] = P[40]*ekf_use_psi;
	tmp[273] = -tmp[157];
	tmp[274] = -tmp[158];
	tmp[275] = -tmp[159];
	tmp[276] = P[41]*ekf_use_psi;
	tmp[277] = -ekf_use_phi*tmp[167] + 1;
	tmp[278] = -tmp[168];
	tmp[279] = -tmp[169];
	tmp[280] = -tmp[170];
	tmp[281] = -ekf_use_theta*tmp[177] + 1;
	tmp[282] = -tmp[179];
	tmp[283] = -tmp[180];
	tmp[284] = -tmp[181];
	tmp[285] = ekf_use_phi*tmp[178];
	tmp[286] = -ekf_use_psi*tmp[187] + 1;
	tmp[287] = -tmp[190];
	tmp[288] = -tmp[191];
	tmp[289] = -tmp[192];
	tmp[290] = ekf_use_phi*tmp[189];
	tmp[291] = ekf_use_theta*tmp[188];
	tmp[292] = -tmp[201];
	tmp[293] = -tmp[202];
	tmp[294] = -tmp[203];
	tmp[295] = ekf_use_phi*tmp[200];
	tmp[296] = ekf_use_theta*tmp[199];
	tmp[297] = ekf_use_psi*tmp[198];
	tmp[298] = -tmp[212];
	tmp[299] = -tmp[213];
	tmp[300] = -tmp[214];
	tmp[301] = ekf_use_phi*tmp[211];
	tmp[302] = ekf_use_theta*tmp[210];
	tmp[303] = ekf_use_psi*tmp[209];
	tmp[304] = -tmp[223];
	tmp[305] = -tmp[224];
	tmp[306] = -tmp[225];
	tmp[307] = ekf_use_phi*tmp[222];
	tmp[308] = ekf_use_theta*tmp[221];
	tmp[309] = ekf_use_psi*tmp[220];
	tmp[310] = -tmp[234];
	tmp[311] = -tmp[235];
	tmp[312] = -tmp[236];
	tmp[313] = ekf_use_phi*tmp[233];
	tmp[314] = ekf_use_theta*tmp[232];
	tmp[315] = ekf_use_psi*tmp[231];
	tmp[316] = -tmp[245];
	tmp[317] = -tmp[246];
	tmp[318] = -tmp[247];
	tmp[319] = ekf_use_phi*tmp[244];
	tmp[320] = ekf_use_theta*tmp[243];
	tmp[321] = ekf_use_psi*tmp[242];
	tmp[322] = -tmp[256];
	tmp[323] = -tmp[257];
	tmp[324] = -tmp[258];
	tmp[325] = ekf_use_phi*tmp[255];
	tmp[326] = ekf_use_theta*tmp[254];
	tmp[327] = ekf_use_psi*tmp[253];
	X_new[0] = X[0] + tmp[0]*tmp[49] + tmp[50]*tmp[57] + tmp[58]*tmp[68] + tmp[69]*tmp[78] + tmp[79]*tmp[89] + tmp[90]*(tmp[100] + tmp[103]);
	X_new[1] = X[1] + tmp[0]*tmp[109] + tmp[110]*tmp[50] + tmp[111]*tmp[58] + tmp[112]*tmp[69] + tmp[113]*tmp[79] + tmp[114]*tmp[90];
	X_new[2] = X[2] + tmp[0]*tmp[120] + tmp[121]*tmp[50] + tmp[122]*tmp[58] + tmp[123]*tmp[69] + tmp[124]*tmp[79] + tmp[125]*tmp[90];
	X_new[3] = X[3] + tmp[0]*tmp[132] + tmp[133]*tmp[50] + tmp[134]*tmp[58] + tmp[135]*tmp[69] + tmp[136]*tmp[79] + tmp[137]*tmp[90];
	X_new[4] = X[4] + tmp[0]*tmp[143] + tmp[144]*tmp[50] + tmp[145]*tmp[58] + tmp[146]*tmp[69] + tmp[147]*tmp[79] + tmp[148]*tmp[90];
	X_new[5] = X[5] + tmp[0]*tmp[154] + tmp[155]*tmp[50] + tmp[156]*tmp[58] + tmp[157]*tmp[69] + tmp[158]*tmp[79] + tmp[159]*tmp[90];
	X_new[6] = X[6] + tmp[0]*tmp[165] + tmp[166]*tmp[50] + tmp[167]*tmp[58] + tmp[168]*tmp[69] + tmp[169]*tmp[79] + tmp[170]*tmp[90];
	X_new[7] = X[7] + tmp[0]*tmp[176] + tmp[177]*tmp[50] + tmp[178]*tmp[58] + tmp[179]*tmp[69] + tmp[180]*tmp[79] + tmp[181]*tmp[90];
	X_new[8] = X[8] + tmp[0]*tmp[187] + tmp[188]*tmp[50] + tmp[189]*tmp[58] + tmp[190]*tmp[69] + tmp[191]*tmp[79] + tmp[192]*tmp[90];
	X_new[9] = X[9] + tmp[0]*tmp[198] + tmp[199]*tmp[50] + tmp[200]*tmp[58] + tmp[201]*tmp[69] + tmp[202]*tmp[79] + tmp[203]*tmp[90];
	X_new[10] = X[10] + tmp[0]*tmp[209] + tmp[210]*tmp[50] + tmp[211]*tmp[58] + tmp[212]*tmp[69] + tmp[213]*tmp[79] + tmp[214]*tmp[90];
	X_new[11] = X[11] + tmp[0]*tmp[220] + tmp[221]*tmp[50] + tmp[222]*tmp[58] + tmp[223]*tmp[69] + tmp[224]*tmp[79] + tmp[225]*tmp[90];
	X_new[12] = X[12] + tmp[0]*tmp[231] + tmp[232]*tmp[50] + tmp[233]*tmp[58] + tmp[234]*tmp[69] + tmp[235]*tmp[79] + tmp[236]*tmp[90];
	X_new[13] = X[13] + tmp[0]*tmp[242] + tmp[243]*tmp[50] + tmp[244]*tmp[58] + tmp[245]*tmp[69] + tmp[246]*tmp[79] + tmp[247]*tmp[90];
	X_new[14] = X[14] + tmp[0]*tmp[253] + tmp[254]*tmp[50] + tmp[255]*tmp[58] + tmp[256]*tmp[69] + tmp[257]*tmp[79] + tmp[258]*tmp[90];
	P_new[0] = P[0]*(-tmp[101] - tmp[103]) - P[1]*tmp[89] - P[3]*tmp[78] - tmp[13]*tmp[68] - tmp[23]*tmp[57] - tmp[49]*tmp[5];
	P_new[1] = P[0]*tmp[261] + P[1]*tmp[260] + P[3]*tmp[259] - tmp[109]*tmp[5] - tmp[110]*tmp[23] - tmp[111]*tmp[13];
	P_new[2] = P[1]*tmp[261] + P[2]*tmp[260] + P[4]*tmp[259] - tmp[104]*tmp[109] - tmp[106]*tmp[110] - tmp[107]*tmp[111];
	P_new[3] = P[0]*tmp[264] + P[1]*tmp[263] + P[3]*tmp[262] - tmp[120]*tmp[5] - tmp[121]*tmp[23] - tmp[122]*tmp[13];
	P_new[4] = P[1]*tmp[264] + P[2]*tmp[263] + P[4]*tmp[262] - tmp[104]*tmp[120] - tmp[106]*tmp[121] - tmp[107]*tmp[122];
	P_new[5] = P[3]*tmp[264] + P[4]*tmp[263] + P[5]*tmp[262] - tmp[115]*tmp[120] - tmp[117]*tmp[121] - tmp[118]*tmp[122];
	P_new[6] = P[0]*tmp[267] + P[1]*tmp[266] + P[3]*tmp[265] + P[6] - tmp[132]*tmp[5] - tmp[133]*tmp[23] - tmp[134]*tmp[13];
	P_new[7] = P[1]*tmp[267] + P[2]*tmp[266] + P[4]*tmp[265] + P[7] - tmp[104]*tmp[132] - tmp[106]*tmp[133] - tmp[107]*tmp[134];
	P_new[8] = P[3]*tmp[267] + P[4]*tmp[266] + P[5]*tmp[265] + P[8] - tmp[115]*tmp[132] - tmp[117]*tmp[133] - tmp[118]*tmp[134];
	P_new[9] = P[6]*tmp[267] + P[7]*tmp[266] + P[8]*tmp[265] + P[9] - tmp[128]*tmp[133] - tmp[129]*tmp[134] - tmp[132]*tmp[268];
	P_new[10] = P[0]*tmp[271] + P[10] + P[1]*tmp[270] + P[3]*tmp[269] - tmp[13]*tmp[145] - tmp[143]*tmp[5] - tmp[144]*tmp[23];
	P_new[11] = P[11] + P[1]*tmp[271] + P[2]*tmp[270] + P[4]*tmp[269] - tmp[104]*tmp[143] - tmp[106]*tmp[144] - tmp[107]*tmp[145];
	P_new[12] = P[12] + P[3]*tmp[271] + P[4]*tmp[270] + P[5]*tmp[269] - tmp[115]*tmp[143] - tmp[117]*tmp[144] - tmp[118]*tmp[145];
	P_new[13] = P[13] + P[6]*tmp[271] + P[7]*tmp[270] + P[8]*tmp[269] - tmp[128]*tmp[144] - tmp[129]*tmp[145] - tmp[143]*tmp[268];
	P_new[14] = P[10]*tmp[271] + P[11]*tmp[270] + P[12]*tmp[269] + P[14] - tmp[139]*tmp[144] - tmp[140]*tmp[145] - tmp[143]*tmp[272];
	P_new[15] = P[0]*tmp[275] + P[15] + P[1]*tmp[274] + P[3]*tmp[273] - tmp[13]*tmp[156] - tmp[154]*tmp[5] - tmp[155]*tmp[23];
	P_new[16] = P[16] + P[1]*tmp[275] + P[2]*tmp[274] + P[4]*tmp[273] - tmp[104]*tmp[154] - tmp[106]*tmp[155] - tmp[107]*tmp[156];
	P_new[17] = P[17] + P[3]*tmp[275] + P[4]*tmp[274] + P[5]*tmp[273] - tmp[115]*tmp[154] - tmp[117]*tmp[155] - tmp[118]*tmp[156];
	P_new[18] = P[18] + P[6]*tmp[275] + P[7]*tmp[274] + P[8]*tmp[273] - tmp[128]*tmp[155] - tmp[129]*tmp[156] - tmp[154]*tmp[268];
	P_new[19] = P[10]*tmp[275] + P[11]*tmp[274] + P[12]*tmp[273] + P[19] - tmp[139]*tmp[155] - tmp[140]*tmp[156] - tmp[154]*tmp[272];
	P_new[20] = P[15]*tmp[275] + P[16]*tmp[274] + P[17]*tmp[273] + P[20] - tmp[150]*tmp[155] - tmp[151]*tmp[156] - tmp[154]*tmp[276];
	P_new[21] = P[0]*tmp[280] + P[1]*tmp[279] + P[21]*tmp[277] + P[3]*tmp[278] - tmp[165]*tmp[5] - tmp[166]*tmp[23];
	P_new[22] = P[1]*tmp[280] + P[22]*tmp[277] + P[2]*tmp[279] + P[4]*tmp[278] - tmp[104]*tmp[165] - tmp[106]*tmp[166];
	P_new[23] = P[23]*tmp[277] + P[3]*tmp[280] + P[4]*tmp[279] + P[5]*tmp[278] - tmp[115]*tmp[165] - tmp[117]*tmp[166];
	P_new[24] = P[24]*tmp[277] + P[6]*tmp[280] + P[7]*tmp[279] + P[8]*tmp[278] - tmp[128]*tmp[166] - tmp[165]*tmp[268];
	P_new[25] = P[10]*tmp[280] + P[11]*tmp[279] + P[12]*tmp[278] + P[25]*tmp[277] - tmp[139]*tmp[166] - tmp[165]*tmp[272];
	P_new[26] = P[15]*tmp[280] + P[16]*tmp[279] + P[17]*tmp[278] + P[26]*tmp[277] - tmp[150]*tmp[166] - tmp[165]*tmp[276];
	P_new[27] = P[21]*tmp[280] + P[22]*tmp[279] + P[23]*tmp[278] + P[27]*tmp[277] - tmp[160]*tmp[165] - tmp[162]*tmp[166];
	P_new[28] = P[0]*tmp[284] + P[1]*tmp[283] + P[28]*tmp[281] + P[3]*tmp[282] - tmp[13]*tmp[178] - tmp[176]*tmp[5];
	P_new[29] = P[1]*tmp[284] + P[29]*tmp[281] + P[2]*tmp[283] + P[4]*tmp[282] - tmp[104]*tmp[176] - tmp[107]*tmp[178];
	P_new[30] = P[30]*tmp[281] + P[3]*tmp[284] + P[4]*tmp[283] + P[5]*tmp[282] - tmp[115]*tmp[176] - tmp[118]*tmp[178];
	P_new[31] = P[31]*tmp[281] + P[6]*tmp[284] + P[7]*tmp[283] + P[8]*tmp[282] - tmp[129]*tmp[178] - tmp[176]*tmp[268];
	P_new[32] = P[10]*tmp[284] + P[11]*tmp[283] + P[12]*tmp[282] + P[32]*tmp[281] - tmp[140]*tmp[178] - tmp[176]*tmp[272];
	P_new[33] = P[15]*tmp[284] + P[16]*tmp[283] + P[17]*tmp[282] + P[33]*tmp[281] - tmp[151]*tmp[178] - tmp[176]*tmp[276];
	P_new[34] = P[21]*tmp[284] + P[22]*tmp[283] + P[23]*tmp[282] - P[27]*tmp[285] + P[34]*tmp[281] - tmp[160]*tmp[176];
	P_new[35] = P[28]*tmp[284] + P[29]*tmp[283] + P[30]*tmp[282] - P[34]*tmp[285] + P[35]*tmp[281] - tmp[171]*tmp[176];
	P_new[36] = P[0]*tmp[289] + P[1]*tmp[288] + P[36]*tmp[286] + P[3]*tmp[287] - tmp[13]*tmp[189] - tmp[188]*tmp[23];
	P_new[37] = P[1]*tmp[289] + P[2]*tmp[288] + P[37]*tmp[286] + P[4]*tmp[287] - tmp[106]*tmp[188] - tmp[107]*tmp[189];
	P_new[38] = P[38]*tmp[286] + P[3]*tmp[289] + P[4]*tmp[288] + P[5]*tmp[287] - tmp[117]*tmp[188] - tmp[118]*tmp[189];
	P_new[39] = P[39]*tmp[286] + P[6]*tmp[289] + P[7]*tmp[288] + P[8]*tmp[287] - tmp[128]*tmp[188] - tmp[129]*tmp[189];
	P_new[40] = P[10]*tmp[289] + P[11]*tmp[288] + P[12]*tmp[287] + P[40]*tmp[286] - tmp[139]*tmp[188] - tmp[140]*tmp[189];
	P_new[41] = P[15]*tmp[289] + P[16]*tmp[288] + P[17]*tmp[287] + P[41]*tmp[286] - tmp[150]*tmp[188] - tmp[151]*tmp[189];
	P_new[42] = P[21]*tmp[289] + P[22]*tmp[288] + P[23]*tmp[287] - P[27]*tmp[290] + P[42]*tmp[286] - tmp[162]*tmp[188];
	P_new[43] = P[28]*tmp[289] + P[29]*tmp[288] + P[30]*tmp[287] - P[34]*tmp[290] - P[35]*tmp[291] + P[43]*tmp[286];
	P_new[44] = P[36]*tmp[289] + P[37]*tmp[288] + P[38]*tmp[287] - P[42]*tmp[290] - P[43]*tmp[291] + P[44]*tmp[286];
	P_new[45] = P[0]*tmp[294] + P[1]*tmp[293] + P[3]*tmp[292] + P[45] - tmp[13]*tmp[200] - tmp[198]*tmp[5] - tmp[199]*tmp[23];
	P_new[46] = P[1]*tmp[294] + P[2]*tmp[293] + P[46] + P[4]*tmp[292] - tmp[104]*tmp[198] - tmp[106]*tmp[199] - tmp[107]*tmp[200];
	P_new[47] = P[3]*tmp[294] + P[47] + P[4]*tmp[293] + P[5]*tmp[292] - tmp[115]*tmp[198] - tmp[117]*tmp[199] - tmp[118]*tmp[200];
	P_new[48] = P[48] + P[6]*tmp[294] + P[7]*tmp[293] + P[8]*tmp[292] - tmp[128]*tmp[199] - tmp[129]*tmp[200] - tmp[198]*tmp[268];
	P_new[49] = P[10]*tmp[294] + P[11]*tmp[293] + P[12]*tmp[292] + P[49] - tmp[139]*tmp[199] - tmp[140]*tmp[200] - tmp[198]*tmp[272];
	P_new[50] = P[15]*tmp[294] + P[16]*tmp[293] + P[17]*tmp[292] + P[50] - tmp[150]*tmp[199] - tmp[151]*tmp[200] - tmp[198]*tmp[276];
	P_new[51] = P[21]*tmp[294] + P[22]*tmp[293] + P[23]*tmp[292] - P[27]*tmp[295] + P[51] - tmp[160]*tmp[198] - tmp[162]*tmp[199];
	P_new[52] = P[28]*tmp[294] + P[29]*tmp[293] + P[30]*tmp[292] - P[34]*tmp[295] - P[35]*tmp[296] + P[52] - tmp[171]*tmp[198];
	P_new[53] = P[36]*tmp[294] + P[37]*tmp[293] + P[38]*tmp[292] - P[42]*tmp[295] - P[43]*tmp[296] - P[44]*tmp[297] + P[53];
	P_new[54] = P[45]*tmp[294] + P[46]*tmp[293] + P[47]*tmp[292] - P[51]*tmp[295] - P[52]*tmp[296] - P[53]*tmp[297] + P[54];
	P_new[55] = P[0]*tmp[300] + P[1]*tmp[299] + P[3]*tmp[298] + P[55] - tmp[13]*tmp[211] - tmp[209]*tmp[5] - tmp[210]*tmp[23];
	P_new[56] = P[1]*tmp[300] + P[2]*tmp[299] + P[4]*tmp[298] + P[56] - tmp[104]*tmp[209] - tmp[106]*tmp[210] - tmp[107]*tmp[211];
	P_new[57] = P[3]*tmp[300] + P[4]*tmp[299] + P[57] + P[5]*tmp[298] - tmp[115]*tmp[209] - tmp[117]*tmp[210] - tmp[118]*tmp[211];
	P_new[58] = P[58] + P[6]*tmp[300] + P[7]*tmp[299] + P[8]*tmp[298] - tmp[128]*tmp[210] - tmp[129]*tmp[211] - tmp[209]*tmp[268];
	P_new[59] = P[10]*tmp[300] + P[11]*tmp[299] + P[12]*tmp[298] + P[59] - tmp[139]*tmp[210] - tmp[140]*tmp[211] - tmp[209]*tmp[272];
	P_new[60] = P[15]*tmp[300] + P[16]*tmp[299] + P[17]*tmp[298] + P[60] - tmp[150]*tmp[210] - tmp[151]*tmp[211] - tmp[209]*tmp[276];
	P_new[61] = P[21]*tmp[300] + P[22]*tmp[299] + P[23]*tmp[298] - P[27]*tmp[301] + P[61] - tmp[160]*tmp[209] - tmp[162]*tmp[210];
	P_new[62] = P[28]*tmp[300] + P[29]*tmp[299] + P[30]*tmp[298] - P[34]*tmp[301] - P[35]*tmp[302] + P[62] - tmp[171]*tmp[209];
	P_new[63] = P[36]*tmp[300] + P[37]*tmp[299] + P[38]*tmp[298] - P[42]*tmp[301] - P[43]*tmp[302] - P[44]*tmp[303] + P[63];
	P_new[64] = P[45]*tmp[300] + P[46]*tmp[299] + P[47]*tmp[298] - P[51]*tmp[301] - P[52]*tmp[302] - P[53]*tmp[303] + P[64];
	P_new[65] = P[55]*tmp[300] + P[56]*tmp[299] + P[57]*tmp[298] - P[61]*tmp[301] - P[62]*tmp[302] - P[63]*tmp[303] + P[65];
	P_new[66] = P[0]*tmp[306] + P[1]*tmp[305] + P[3]*tmp[304] + P[66] - tmp[13]*tmp[222] - tmp[220]*tmp[5] - tmp[221]*tmp[23];
	P_new[67] = P[1]*tmp[306] + P[2]*tmp[305] + P[4]*tmp[304] + P[67] - tmp[104]*tmp[220] - tmp[106]*tmp[221] - tmp[107]*tmp[222];
	P_new[68] = P[3]*tmp[306] + P[4]*tmp[305] + P[5]*tmp[304] + P[68] - tmp[115]*tmp[220] - tmp[117]*tmp[221] - tmp[118]*tmp[222];
	P_new[69] = P[69] + P[6]*tmp[306] + P[7]*tmp[305] + P[8]*tmp[304] - tmp[128]*tmp[221] - tmp[129]*tmp[222] - tmp[220]*tmp[268];
	P_new[70] = P[10]*tmp[306] + P[11]*tmp[305] + P[12]*tmp[304] + P[70] - tmp[139]*tmp[221] - tmp[140]*tmp[222] - tmp[220]*tmp[272];
	P_new[71] = P[15]*tmp[306] + P[16]*tmp[305] + P[17]*tmp[304] + P[71] - tmp[150]*tmp[221] - tmp[151]*tmp[222] - tmp[220]*tmp[276];
	P_new[72] = P[21]*tmp[306] + P[22]*tmp[305] + P[23]*tmp[304] - P[27]*tmp[307] + P[72] - tmp[160]*tmp[220] - tmp[162]*tmp[221];
	P_new[73] = P[28]*tmp[306] + P[29]*tmp[305] + P[30]*tmp[304] - P[34]*tmp[307] - P[35]*tmp[308] + P[73] - tmp[171]*tmp[220];
	P_new[74] = P[36]*tmp[306] + P[37]*tmp[305] + P[38]*tmp[304] - P[42]*tmp[307] - P[43]*tmp[308] - P[44]*tmp[309] + P[74];
	P_new[75] = P[45]*tmp[306] + P[46]*tmp[305] + P[47]*tmp[304] - P[51]*tmp[307] - P[52]*tmp[308] - P[53]*tmp[309] + P[75];
	P_new[76] = P[55]*tmp[306] + P[56]*tmp[305] + P[57]*tmp[304] - P[61]*tmp[307] - P[62]*tmp[308] - P[63]*tmp[309] + P[76];
	P_new[77] = P[66]*tmp[306] + P[67]*tmp[305] + P[68]*tmp[304] - P[72]*tmp[307] - P[73]*tmp[308] - P[74]*tmp[309] + P[77];
	P_new[78] = P[0]*tmp[312] + P[1]*tmp[311] + P[3]*tmp[310] + P[78] - tmp[13]*tmp[233] - tmp[231]*tmp[5] - tmp[232]*tmp[23];
	P_new[79] = P[1]*tmp[312] + P[2]*tmp[311] + P[4]*tmp[310] + P[79] - tmp[104]*tmp[231] - tmp[106]*tmp[232] - tmp[107]*tmp[233];
	P_new[80] = P[3]*tmp[312] + P[4]*tmp[311] + P[5]*tmp[310] + P[80] - tmp[115]*tmp[231] - tmp[117]*tmp[232] - tmp[118]*tmp[233];
	P_new[81] = P[6]*tmp[312] + P[7]*tmp[311] + P[81] + P[8]*tmp[310] - tmp[128]*tmp[232] - tmp[129]*tmp[233] - tmp[231]*tmp[268];
	P_new[82] = P[10]*tmp[312] + P[11]*tmp[311] + P[12]*tmp[310] + P[82] - tmp[139]*tmp[232] - tmp[140]*tmp[233] - tmp[231]*tmp[272];
	P_new[83] = P[15]*tmp[312] + P[16]*tmp[311] + P[17]*tmp[310] + P[83] - tmp[150]*tmp[232] - tmp[151]*tmp[233] - tmp[231]*tmp[276];
	P_new[84] = P[21]*tmp[312] + P[22]*tmp[311] + P[23]*tmp[310] - P[27]*tmp[313] + P[84] - tmp[160]*tmp[231] - tmp[162]*tmp[232];
	P_new[85] = P[28]*tmp[312] + P[29]*tmp[311] + P[30]*tmp[310] - P[34]*tmp[313] - P[35]*tmp[314] + P[85] - tmp[171]*tmp[231];
	P_new[86] = P[36]*tmp[312] + P[37]*tmp[311] + P[38]*tmp[310] - P[42]*tmp[313] - P[43]*tmp[314] - P[44]*tmp[315] + P[86];
	P_new[87] = P[45]*tmp[312] + P[46]*tmp[311] + P[47]*tmp[310] - P[51]*tmp[313] - P[52]*tmp[314] - P[53]*tmp[315] + P[87];
	P_new[88] = P[55]*tmp[312] + P[56]*tmp[311] + P[57]*tmp[310] - P[61]*tmp[313] - P[62]*tmp[314] - P[63]*tmp[315] + P[88];
	P_new[89] = P[66]*tmp[312] + P[67]*tmp[311] + P[68]*tmp[310] - P[72]*tmp[313] - P[73]*tmp[314] - P[74]*tmp[315] + P[89];
	P_new[90] = P[78]*tmp[312] + P[79]*tmp[311] + P[80]*tmp[310] - P[84]*tmp[313] - P[85]*tmp[314] - P[86]*tmp[315] + P[90];
	P_new[91] = P[0]*tmp[318] + P[1]*tmp[317] + P[3]*tmp[316] + P[91] - tmp[13]*tmp[244] - tmp[23]*tmp[243] - tmp[242]*tmp[5];
	P_new[92] = P[1]*tmp[318] + P[2]*tmp[317] + P[4]*tmp[316] + P[92] - tmp[104]*tmp[242] - tmp[106]*tmp[243] - tmp[107]*tmp[244];
	P_new[93] = P[3]*tmp[318] + P[4]*tmp[317] + P[5]*tmp[316] + P[93] - tmp[115]*tmp[242] - tmp[117]*tmp[243] - tmp[118]*tmp[244];
	P_new[94] = P[6]*tmp[318] + P[7]*tmp[317] + P[8]*tmp[316] + P[94] - tmp[128]*tmp[243] - tmp[129]*tmp[244] - tmp[242]*tmp[268];
	P_new[95] = P[10]*tmp[318] + P[11]*tmp[317] + P[12]*tmp[316] + P[95] - tmp[139]*tmp[243] - tmp[140]*tmp[244] - tmp[242]*tmp[272];
	P_new[96] = P[15]*tmp[318] + P[16]*tmp[317] + P[17]*tmp[316] + P[96] - tmp[150]*tmp[243] - tmp[151]*tmp[244] - tmp[242]*tmp[276];
	P_new[97] = P[21]*tmp[318] + P[22]*tmp[317] + P[23]*tmp[316] - P[27]*tmp[319] + P[97] - tmp[160]*tmp[242] - tmp[162]*tmp[243];
	P_new[98] = P[28]*tmp[318] + P[29]*tmp[317] + P[30]*tmp[316] - P[34]*tmp[319] - P[35]*tmp[320] + P[98] - tmp[171]*tmp[242];
	P_new[99] = P[36]*tmp[318] + P[37]*tmp[317] + P[38]*tmp[316] - P[42]*tmp[319] - P[43]*tmp[320] - P[44]*tmp[321] + P[99];
	P_new[100] = P[100] + P[45]*tmp[318] + P[46]*tmp[317] + P[47]*tmp[316] - P[51]*tmp[319] - P[52]*tmp[320] - P[53]*tmp[321];
	P_new[101] = P[101] + P[55]*tmp[318] + P[56]*tmp[317] + P[57]*tmp[316] - P[61]*tmp[319] - P[62]*tmp[320] - P[63]*tmp[321];
	P_new[102] = P[102] + P[66]*tmp[318] + P[67]*tmp[317] + P[68]*tmp[316] - P[72]*tmp[319] - P[73]*tmp[320] - P[74]*tmp[321];
	P_new[103] = P[103] + P[78]*tmp[318] + P[79]*tmp[317] + P[80]*tmp[316] - P[84]*tmp[319] - P[85]*tmp[320] - P[86]*tmp[321];
	P_new[104] = P[104] + P[91]*tmp[318] + P[92]*tmp[317] + P[93]*tmp[316] - P[97]*tmp[319] - P[98]*tmp[320] - P[99]*tmp[321];
	P_new[105] = P[0]*tmp[324] + P[105] + P[1]*tmp[323] + P[3]*tmp[322] - tmp[13]*tmp[255] - tmp[23]*tmp[254] - tmp[253]*tmp[5];
	P_new[106] = P[106] + P[1]*tmp[324] + P[2]*tmp[323] + P[4]*tmp[322] - tmp[104]*tmp[253] - tmp[106]*tmp[254] - tmp[107]*tmp[255];
	P_new[107] = P[107] + P[3]*tmp[324] + P[4]*tmp[323] + P[5]*tmp[322] - tmp[115]*tmp[253] - tmp[117]*tmp[254] - tmp[118]*tmp[255];
	P_new[108] = P[108] + P[6]*tmp[324] + P[7]*tmp[323] + P[8]*tmp[322] - tmp[128]*tmp[254] - tmp[129]*tmp[255] - tmp[253]*tmp[268];
	P_new[109] = P[109] + P[10]*tmp[324] + P[11]*tmp[323] + P[12]*tmp[322] - tmp[139]*tmp[254] - tmp[140]*tmp[255] - tmp[253]*tmp[272];
	P_new[110] = P[110] + P[15]*tmp[324] + P[16]*tmp[323] + P[17]*tmp[322] - tmp[150]*tmp[254] - tmp[151]*tmp[255] - tmp[253]*tmp[276];
	P_new[111] = P[111] + P[21]*tmp[324] + P[22]*tmp[323] + P[23]*tmp[322] - P[27]*tmp[325] - tmp[160]*tmp[253] - tmp[162]*tmp[254];
	P_new[112] = P[112] + P[28]*tmp[324] + P[29]*tmp[323] + P[30]*tmp[322] - P[34]*tmp[325] - P[35]*tmp[326] - tmp[171]*tmp[253];
	P_new[113] = P[113] + P[36]*tmp[324] + P[37]*tmp[323] + P[38]*tmp[322] - P[42]*tmp[325] - P[43]*tmp[326] - P[44]*tmp[327];
	P_new[114] = P[114] + P[45]*tmp[324] + P[46]*tmp[323] + P[47]*tmp[322] - P[51]*tmp[325] - P[52]*tmp[326] - P[53]*tmp[327];
	P_new[115] = P[115] + P[55]*tmp[324] + P[56]*tmp[323] + P[57]*tmp[322] - P[61]*tmp[325] - P[62]*tmp[326] - P[63]*tmp[327];
	P_new[116] = P[116] + P[66]*tmp[324] + P[67]*tmp[323] + P[68]*tmp[322] - P[72]*tmp[325] - P[73]*tmp[326] - P[74]*tmp[327];
	P_new[117] = P[117] + P[78]*tmp[324] + P[79]*tmp[323] + P[80]*tmp[322] - P[84]*tmp[325] - P[85]*tmp[326] - P[86]*tmp[327];
	P_new[118] = P[118] + P[91]*tmp[324] + P[92]*tmp[323] + P[93]*tmp[322] - P[97]*tmp[325] - P[98]*tmp[326] - P[99]*tmp[327];
	P_new[119] = P[105]*tmp[324] + P[106]*tmp[323] + P[107]*tmp[322] - P[111]*tmp[325] - P[112]*tmp[326] - P[113]*tmp[327] + P[119];

    // swap X, X_new and P, P_new pointers
    swap_ptr = X;
    X = X_new;
    X_new = swap_ptr;

    swap_ptr = P;
    P = P_new;
    P_new = swap_ptr;
}
